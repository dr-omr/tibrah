<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="د. عمر العماد - رحلتك نحو الشفاء بالطب الشمولي والوظيفي. أدوات ذكية، جلسات علاجية، ومنتجات طبيعية.">
    <meta name="keywords" content="طب شمولي, طب وظيفي, علاج عن بعد, منتجات طبيعية, شفاء, دكتور عمر العماد, طِبرا, عجلة الحياة, تقييم صحي, DMSO, ترددات شفائية, تشخيص ذكي, خطة علاجية, تحليل الدم, خريطة الجسم, مفكرة الأعراض, تردد النقلة الموازية, صلاح الراشد, اختبار لوشير للألوان, الطب الشعوري, احمد الدملاوي">
    <title>د. عمر العماد | خبير الطب الشمولي والوظيفي</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <style>
        /* --- GLOBAL DESIGN SYSTEM & VARIABLES (REFINED) --- */
        :root {
            --primary-color: #5a6e5a; /* Muted Sage Green */
            --primary-dark: #435243;  /* Darker Sage */
            --secondary-color: #f6f3ef; /* Warmer, richer off-white */
            --accent-color: #c8a07d;  /* Warm Tan */
            --accent-light: #e6d3c1; /* Lighter Tan */
            --accent-gold: #e0c4a4;   /* Soft Gold for highlights */
            --text-dark: #2f3d2f;    /* Desaturated Green-Black for text */
            --text-light: #faf8f5;   /* Softer light text */
        }
        
        /* --- GENERAL BODY & TYPOGRAPHY STYLES --- */
        body {
            font-family: 'Noto Kufi Arabic', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-dark);
            scroll-behavior: smooth;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Noto Kufi Arabic', sans-serif;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .font-brand {
            font-family: 'Great Vibes', cursive;
        }

        /* --- ADVANCED ANIMATIONS & EFFECTS --- */
        @keyframes subtle-pan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes ripple-effect { to { transform: scale(4); opacity: 0; } }
        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--accent-gold); }
            50% { box-shadow: 0 0 20px var(--accent-gold); }
            100% { box-shadow: 0 0 5px var(--accent-gold); }
        }
        @keyframes pulse-loader {
          0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(90, 110, 90, 0.7); }
          70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(90, 110, 90, 0); }
          100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(90, 110, 90, 0); }
        }

        /* --- HERO SECTION STYLES --- */
        .hero-bg { animation: subtle-pan 25s ease-in-out infinite; }
        .hero-gradient { background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.2)); }

        /* --- ENHANCED BUTTON STYLES --- */
        .btn { position: relative; overflow: hidden; transition: all 0.3s ease; transform-style: preserve-3d; }
        .btn-primary { background-color: var(--primary-color); color: var(--text-light); }
        .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
        .btn-secondary { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); }
        .btn-secondary:hover { background-color: var(--primary-color); color: var(--text-light); transform: translateY(-4px); box-shadow: 0 8px 15px rgba(90, 110, 90, 0.2); }
        .btn-glow { animation: glow 3s infinite ease-in-out; }
        .ripple { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple-effect 0.6s linear; background-color: rgba(255, 255, 255, 0.5); }
        
        /* --- INTERACTIVE DASHBOARD CARD --- */
        .dashboard-card { cursor: pointer; transition: transform 0.4s ease, box-shadow 0.4s ease; transform-style: preserve-3d; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }

        /* --- SECTION STYLES --- */
        .section-title::after { content: ''; display: block; width: 60px; height: 3px; background-color: var(--accent-color); margin: 1rem auto 0; transition: width 0.5s ease; }
        .section-title:hover::after { width: 100px; }
        
        /* --- WHATSAPP & MODAL --- */
        .whatsapp-float { position: fixed; width: 60px; height: 60px; bottom: 40px; left: 40px; background-color: #25d366; color: #FFF; border-radius: 50px; text-align: center; font-size: 30px; box-shadow: 2px 2px 10px rgba(0,0,0,0.2); z-index: 100; transition: transform 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .whatsapp-float:hover { transform: scale(1.1) rotate(10deg); }
        #tool-modal, #quiz-modal { transition: opacity 0.3s ease, backdrop-filter 0.3s ease; backdrop-filter: blur(0px); }
        #tool-modal.is-open, #quiz-modal.is-open { opacity: 1; backdrop-filter: blur(8px); }

        /* --- FADE-IN ANIMATION --- */
        .fade-in-up { opacity: 0; transform: translateY(40px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in-up.is-visible { opacity: 1; transform: translateY(0); }
        
        /* --- AI LOADER --- */
        .ai-loader { text-align: center; }
        .ai-loader .ai-loader-dots { display: inline-block; position: relative; width: 80px; height: 10px; }
        .ai-loader .ai-loader-dots div { position: absolute; top: 0; width: 13px; height: 13px; border-radius: 50%; background-color: var(--primary-color); animation: pulse-loader 1.4s infinite ease-in-out both; }
        .ai-loader .ai-loader-dots .dot1 { left: 8px; animation-delay: -0.32s; }
        .ai-loader .ai-loader-dots .dot2 { left: 32px; animation-delay: -0.16s; }
        .ai-loader .ai-loader-dots .dot3 { left: 56px; }

        /* --- FREQUENCY GENERATOR STYLES (REFINED) --- */
        #frequency-canvas { background: linear-gradient(135deg, #121212 0%, #2f3d2f 100%); border-radius: 8px; box-shadow: inset 0 0 15px rgba(0,0,0,0.6); }
        .freq-btn.active, .music-btn.active { background-color: var(--accent-color); color: white; transform: scale(1.05); box-shadow: 0 0 15px var(--accent-color); border-color: var(--accent-color); }
        .freq-description { font-size: 0.8rem; color: #777; margin-top: 4px; }
        .freq-btn, .music-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }


        /* --- SINGLE POST STYLES --- */
        #view-single-post .post-content h2 { font-size: 1.75rem; font-weight: bold; margin-top: 2rem; margin-bottom: 1rem; color: var(--primary-dark); }
        #view-single-post .post-content p { font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem; }
        #view-single-post .post-content ul { list-style-type: disc; margin-right: 2rem; margin-bottom: 1.5rem; }
        #view-single-post .post-content li { margin-bottom: 0.5rem; }

        /* --- WHEEL OF LIFE --- */
        #wheel-of-life-result { transition: opacity 0.5s ease-in-out; }
        #wheel-of-life-result-container .range-slider {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 8px; border-radius: 4px;
            background: var(--accent-light); outline: none; transition: background 0.3s;
        }
        #wheel-of-life-result-container .range-slider::-webkit-slider-thumb {
             -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
             border-radius: 50%; background: var(--primary-color); cursor: pointer; transition: transform 0.2s;
        }
        #wheel-of-life-result-container .range-slider:hover { background: var(--accent-gold); }
        #wheel-of-life-result-container .range-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }


        /* --- AUDIO PLAYER --- */
        .audio-player { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; box-shadow: 0 8px 32px 0 rgba(0,0,0,0.1); }
        #audio-progress-bar { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; border-radius: 4px; background: var(--accent-light); outline: none; transition: opacity .2s; }
        #audio-progress-bar::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--primary-color); cursor: pointer; }
        
        /* --- BODY MAP (SVG UPGRADE) --- */
        #body-map-svg .organ-path {
            fill: rgba(90, 110, 90, 0.1); /* Lighter base fill */
            stroke: var(--primary-dark);
            stroke-width: 1;
            transition: fill 0.3s ease, transform 0.2s ease;
            cursor: pointer;
        }
        #body-map-svg .organ-path:hover {
            fill: rgba(200, 160, 125, 0.7); /* Accent color on hover */
            transform: scale(1.02);
            stroke-width: 1.5;
        }
        #body-map-svg .organ-path.selected {
            fill: var(--accent-color);
            stroke: var(--primary-dark);
            stroke-width: 2;
        }

        #body-map-info {
             transition: opacity 0.5s ease, transform 0.5s ease;
             max-height: 500px;
             overflow-y: auto;
        }

        /* --- JOURNAL (NEW) --- */
        #journal-form label {
            text-align: right;
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .journal-entry {
            border-right: 4px solid var(--accent-light);
        }

        /* --- LUSCHER QUIZ STYLES --- */
        .color-swatch-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .color-swatch {
            width: 100%;
            height: 60px;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s;
            border: 3px solid transparent;
            position: relative;
        }
        .color-swatch:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .color-swatch.selected {
            opacity: 0.3;
            cursor: not-allowed;
            transform: scale(0.9);
        }
        .color-swatch.selected::after {
            content: attr(data-order);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px black;
        }
        
        /* --- FAQ Section --- */
        .faq-section {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        .faq-section details {
            border-bottom: 1px solid var(--accent-light);
            padding: 1.5rem;
        }
        .faq-section details:last-child {
            border-bottom: none;
        }
        .faq-section summary {
            font-weight: 700;
            color: var(--primary-dark);
            cursor: pointer;
            list-style: none; /* Hide default arrow */
            position: relative;
            padding-left: 2rem;
        }
        .faq-section summary::-webkit-details-marker {
            display: none; /* Hide default arrow for Chrome/Safari */
        }
        .faq-section summary::before {
            content: '+';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: var(--primary-color);
            transition: transform 0.3s ease;
        }
        .faq-section details[open] summary::before {
            transform: translateY(-50%) rotate(45deg);
        }
        .faq-section details[open] p {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-secondary-color text-text-dark">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-sm shadow-lg sticky top-0 z-50 transition-shadow duration-300">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" class="font-brand text-5xl text-primary-dark nav-link" data-view="hero" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.2);">
                د. عمر العماد
            </a>
            <div class="hidden md:flex items-center space-x-reverse space-x-6">
                <a href="#" class="nav-link hover:text-[--primary-color] transition-colors duration-300" data-view="about">عني</a>
                <a href="#" class="nav-link hover:text-[--primary-color] transition-colors duration-300" data-view="dashboard">الخدمات التفاعلية</a>
                <a href="#" class="nav-link hover:text-[--primary-color] transition-colors duration-300" data-view="services">الجلسات</a>
                <a href="#" class="nav-link hover:text-[--primary-color] transition-colors duration-300" data-view="store">المتجر</a>
                <a href="#" class="nav-link hover:text-[--primary-color] transition-colors duration-300" data-view="blog">المدونة</a>
                 <!-- Login/Profile Link -->
                 <div id="auth-section" class="flex items-center">
                     <button id="login-btn" class="font-bold text-[--primary-color] hover:underline">تسجيل الدخول</button>
                     <div id="profile-section-nav" class="hidden items-center">
                         <a href="#" class="nav-link font-bold text-[--primary-color] hover:underline ml-4" data-view="premium-content">ملف المريض</a>
                         <img id="user-avatar" class="w-8 h-8 rounded-full" alt="صورة المستخدم" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM1YTZlNWEiLz4KPHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjIwIiBmaWxsPSJ3aGl0ZSI+VTwvdGV4dD4KPC9zdmc+Cg=='">
                     </div>
                 </div>
            </div>
            <a href="#contact" class="hidden md:block btn btn-primary text-white py-2 px-6 rounded-full">احجز جلستك</a>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </nav>
         <!-- Mobile Menu -->
         <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
             <a href="#" class="nav-link block py-2 hover:text-[--primary-color]" data-view="about">عني</a>
             <a href="#" class="nav-link block py-2 hover:text-[--primary-color]" data-view="dashboard">الخدمات التفاعلية</a>
             <a href="#" class="nav-link block py-2 hover:text-[--primary-color]" data-view="services">الجلسات</a>
             <a href="#" class="nav-link block py-2 hover:text-[--primary-color]" data-view="store">المتجر</a>
             <a href="#" class="nav-link block py-2 hover:text-[--primary-color]" data-view="blog">المدونة</a>
             <a href="#contact" class="block py-2 hover:text-[--primary-color]">تواصل معي</a>
             <hr class="my-2">
             <div id="auth-section-mobile">
                 <button id="login-btn-mobile" class="w-full text-right py-2 font-bold text-[--primary-color]">تسجيل الدخول</button>
                 <a href="#" id="profile-link-mobile" class="nav-link hidden w-full text-right py-2 font-bold text-[--primary-color]" data-view="premium-content">ملف المريض</a>
             </div>
         </div>
    </header>

    <main id="main-content">
        <!-- Hero Section -->
        <section id="view-hero" class="page-view relative h-screen flex items-center justify-center text-white text-center">
            <div class="absolute inset-0 bg-cover" style="background-image: url('assets/images/omar.jpg'); background-position: center 80%;"></div>
            <div class="absolute inset-0 hero-gradient"></div>
            <div class="relative z-10 p-6 fade-in-up">
                <h1 class="font-brand text-6xl md:text-8xl mb-4 text-accent-gold" style="text-shadow: 2px 2px 5px rgba(0,0,0,0.5);">ṬibraSoul</h1>
                <h2 class="text-4xl md:text-6xl font-bold mb-2">د. عمر العماد</h2>
                <p class="text-lg md:text-xl max-w-3xl mx-auto">رحلتك نحو الشفاء المتكامل تبدأ هنا</p>
                <a href="#" class="nav-link mt-8 inline-block btn bg-white text-[--primary-color] font-bold py-3 px-8 rounded-full text-lg btn-glow" data-view="dashboard">اكتشف خدماتنا</a>
            </div>
        </section>

        <!-- Home Services Section -->
        <section id="featured-services" class="page-view py-16 bg-white dark:bg-gray-900 hidden">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 section-title">خدماتنا المميزة</h2>
                <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-3">
                    <!-- Card: Tebra Protocols -->
                    <a href="#" class="group dashboard-card block p-8 rounded-xl shadow-lg text-center smart-tool-btn" data-tool="protocols">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fa-solid fa-vials"></i></div>
                        <h3 class="text-2xl font-bold mb-3">🧪 بروتوكولات طِبرا العلاجية</h3>
                        <p class="text-gray-600 dark:text-gray-300">اكتشف البروتوكولات العلاجية المتكاملة المصممة لمرافقة رحلة الشفاء الجذري.</p>
                    </a>
                    <!-- Card: Consultation Sessions -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="services">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fas fa-user-doctor"></i></div>
                        <h3 class="text-2xl font-bold mb-3">👨‍⚕️ الجلسات الاستشارية</h3>
                        <p class="text-gray-600 dark:text-gray-300">احجز جلسة استشارية شاملة أو جلسة متابعة معي مباشرة.</p>
                    </a>
                    <!-- Card: Healing Store -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="store">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fas fa-store"></i></div>
                        <h3 class="text-2xl font-bold mb-3">🛒 المتجر العلاجي</h3>
                        <p class="text-gray-600 dark:text-gray-300">تصفح المكملات الغذائية والمنتجات الطبيعية التي أوصي بها.</p>
                    </a>
                </div>
            </div>
        </section>

        <!-- Interactive Dashboard Section -->
        <section id="view-dashboard" class="page-view py-20 bg-gray-50 hidden">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-4 section-title">لوحة التحكم التفاعلية</h2>
                <p class="max-w-3xl mx-auto mb-12">اختر الأداة أو الخدمة التي تناسب احتياجك الحالي وابدأ رحلة الشفاء.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Card 1: AI Tools -->
                    <div class="p-8 rounded-xl shadow-lg dashboard-card text-center md:col-span-2">
                        <div class="text-5xl text-[--primary-color] mb-4"><i class="fas fa-magic-wand-sparkles"></i></div>
                        <h3 class="text-2xl font-bold mb-3">الأدوات الذكية</h3>
                        <p class="text-gray-600 mb-6">استخدم أدوات الذكاء الاصطناعي للتشخيص، إنشاء الخطط العلاجية، الحصول على توصيات، والمزيد.</p>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="blood-test-decoder">فك شفرة التحاليل</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="diagnosis">التشخيص</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="treatment-plan">خطة علاجية</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="supplements">توصية مكملات</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="awareness-exercise">تمرين وعي</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="consultation">استشارة آلية</button>
                           <button class="smart-tool-btn btn btn-secondary w-full py-2 rounded-full" data-tool="intention">نية اليوم</button>
                           
                        </div>
                    </div>

                    <!-- Card 2: Wheel of Life -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="wheel-of-life">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fa-solid fa-dharmachakra"></i></div>
                        <h3 class="text-2xl font-bold mb-3">عجلة العافية</h3>
                        <p class="text-gray-600">قيّم جوانب حياتك المختلفة واحصل على رؤى فورية لتحقيق التوازن.</p>
                    </a>
                    
                    <!-- NEW Card: Body Map -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="body-map">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fa-solid fa-person-chalkboard"></i></div>
                        <h3 class="text-2xl font-bold mb-3">خريطة الجسد الشعوري</h3>
                        <p class="text-gray-600">استكشف أعضاء جسدك وافهم رسائلها من منظور الطب الشعوري.</p>
                    </a>

                    <!-- NEW Card: Symptom Journal -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="journal">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fa-solid fa-book-medical"></i></div>
                        <h3 class="text-2xl font-bold mb-3">مفكرة الأعراض والمزاج</h3>
                        <p class="text-gray-600">تتبع صحتك اليومية واكتشف الأنماط الخفية (للمسجلين فقط).</p>
                    </a>

                    <!-- NEW Card: Quizzes -->
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="quizzes">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fa-solid fa-clipboard-question"></i></div>
                        <h3 class="text-2xl font-bold mb-3">التقييمات الصحية</h3>
                        <p class="text-gray-600">أجب عن استبيانات دقيقة لتقييم جوانب محددة من صحتك.</p>
                    </a>

<!-- cards moved -->




                    </a>
<!-- Original Cards (some moved) -->




                    </a>
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="frequencies">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fas fa-wave-square"></i></div>
                        <h3 class="text-2xl font-bold mb-3">الترددات الشفائية</h3>
                        <p class="text-gray-600">استمع إلى ترددات السولفيجيو وترددات النقلة الموازية.</p>
                    </a>




                    </a>
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="blog">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fas fa-book-open"></i></div>
                        <h3 class="text-2xl font-bold mb-3">المقالات والمعرفة</h3>
                        <p class="text-gray-600">اقرأ أحدث المقالات والرؤى حول الطب الشمولي.</p>
                    </a>
                    <a href="#" class="nav-link group dashboard-card block p-8 rounded-xl shadow-lg text-center" data-view="premium-content">
                        <div class="text-5xl text-[--primary-color] mb-4 group-hover:text-[--accent-color] transition-colors"><i class="fas fa-folder-user"></i></div>
                        <h3 class="text-2xl font-bold mb-3">ملف المريض</h3>
                        <p class="text-gray-600">ادخل إلى مساحتك الخاصة لمراجعة نتائجك المحفوظة.</p>
                    </a>
                </div>
            </div>
        </section>
        
        <!-- Wheel of Life Section -->
        <section id="view-wheel-of-life" class="page-view py-20 bg-white hidden">
             <div class="container mx-auto px-6">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 section-title">عجلة العافية الشمولية</h2>
                    <p class="max-w-3xl mx-auto text-lg">قيّم مستوى رضاك في الجوانب الأساسية لحياتك. حرك المؤشرات لتعكس وضعك الحالي، ثم احصل على رؤى فورية لمساعدتك على تحديد نقاط التركيز في رحلتك نحو التوازن.</p>
                </div>

                <div id="wheel-of-life-result-container" class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                    <!-- Chart Canvas -->
                    <div class="w-full max-w-lg mx-auto fade-in-up">
                        <canvas id="wheel-of-life-chart"></canvas>
                    </div>
                    <!-- Sliders -->
                    <div id="wheel-of-life-sliders" class="space-y-4 fade-in-up" style="animation-delay: 0.2s;">
                        <!-- Sliders will be dynamically generated here -->
                    </div>
                </div>

                <!-- Result Section -->
                <div class="mt-12 text-center">
                     <button id="get-wheel-insight-btn" class="btn btn-primary text-white py-3 px-8 text-lg rounded-full">اكشف عن رؤيتك الشخصية</button>
                     <div id="wheel-of-life-result" class="mt-6 p-6 bg-green-50 border-r-4 border-primary-color rounded-lg max-w-4xl mx-auto opacity-0 hidden">
                         <!-- AI Insight will be injected here -->
                     </div>
                </div>
            </div>
        </section>

        <!-- About Me Section -->
        <section id="view-about" class="page-view py-20 bg-white hidden">
             <div class="container mx-auto px-6">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <div class="md:flex items-center gap-12">
                    <div class="md:w-1/3 text-center fade-in-up">
                        <img src="assets/images/omar.jpg" alt="صورة د. عمر العماد" class="rounded-full shadow-2xl mx-auto w-64 h-64 md:w-80 md:h-80 object-cover border-4 border-white">
                    </div>
                    <div class="md:w-2/3 mt-8 md:mt-0 fade-in-up">
                        <h2 class="text-4xl font-bold mb-4 section-title text-right">عن د. عمر العماد</h2>
                        <p class="mb-4">🌿 ماذا لو لم يكن مرضك مجرّد عرَض… بل نداء داخلي للعودة إلى ذاتك؟</p>

                        <p class="mb-4">أنا د. عمر، طبيبٌ عام، وباحثٌ في علوم الشفاء الجسدي–الروحي.<br>لا أقدّم لك دواءً فقط… بل منهجًا يعيدك إلى فطرتك.<br>أسّست <strong>Ṭibra | طِبرا – طب يعيدك إليك</strong> لأدمج فيه بين الطب الحديث، والحكمة التي حملها الأنبياء، والصوت الذي يناديك من داخلك منذ زمن.</p>

                        <h3 class="text-2xl font-semibold text-[--primary-color] mb-2">🔍 ماذا أفعل؟</h3>
                        <ul class="list-disc pr-6 mb-4 text-right">
                            <li>فهم جذر مرضك، لا فقط إيقاف أعراضه</li>
                            <li>استخدام التحاليل والمكملات بطريقة واعية وفعّالة</li>
                            <li>التحرر من أنماط نفسية وجسدية تربك طاقتك</li>
                            <li>بناء برنامج شفاء متكامل: طب حديث × علاج طاقي × غذاء وظيفي × تمرينات شفاء ذاتي</li>
                        </ul>

                        <h3 class="text-2xl font-semibold text-[--primary-color] mb-2">🎯 لمن أعمل؟</h3>
                        <ul class="list-disc pr-6 mb-4 text-right">
                            <li>لمن جرّب كل شيء… ومازال يعاني من مرضه المزمن</li>
                            <li>لمن يؤمن أن الجسد لا يخطئ، بل يتحدث</li>
                            <li>لمن يريد أن يتحرّر من التكرار، ويبدأ مسارًا حقيقيًا نحو الشفاء</li>
                        </ul>

                        <h3 class="text-2xl font-semibold text-[--primary-color] mb-2">🌀 لماذا طِبرا؟</h3>
                        <ul class="list-disc pr-6 mb-4 text-right">
                            <li>لأنّ الطب ليس وصفة… بل وعي أيضًا.</li>
                            <li>لأنّ المرض ليس عدوًا… بل رسالة.</li>
                            <li>ولأنك تستحق أن تُعامل كإنسانٍ حيّ واعٍ، لا رقم في ملف.</li>
                        </ul>

                        <h3 class="text-2xl font-semibold text-[--primary-color] mb-2">🧬 من هو د. عمر؟</h3>
                        <ul class="list-disc pr-6 mb-4 text-right">
                            <li>طبيب عام</li>
                            <li>باحث في الشفاء الوظيفي–الطاقي</li>
                            <li>مؤسس منهج Ṭibra</li>
                            <li>أعمل على تطوير أدوات ذكية تشخّص وترافق رحلة المريض، لا تتحكم فيه</li>
                        </ul>

                        <h3 class="text-2xl font-semibold text-[--primary-color] mb-2">🚀 كيف تبدأ؟</h3>
                        <p class="mb-4">احجز استشارة أولى لتقييم وضعك الجسدي والنفسي، وبناء خطة شفاء مخصصة.<br>
                        أو تعرّف على <a href="#" class="nav-link text-[--accent-color] underline" data-view="dashboard">أدوات “طِبرا” عبر الموقع</a>.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Services Section -->
        <section id="view-services" class="page-view py-20 hidden">
             <div class="container mx-auto px-6 text-center">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <h2 class="text-4xl font-bold mb-4 section-title">جلسات العلاج الشمولي</h2>
                <p class="max-w-2xl mx-auto mb-12">جلسات شخصية عن بعد، مصممة خصيصاً لتلبية احتياجاتك الفريدة ومساعدتك على تحقيق أهدافك الصحية.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2">
                        <div class="text-5xl text-[--accent-color] mb-4"><i class="fas fa-user-md"></i></div>
                        <h3 class="text-2xl font-bold mb-3">استشارة أولية شاملة</h3>
                        <p class="mb-6">جلسة لمدة 90 دقيقة لتقييم حالتك الصحية بالكامل، مناقشة تاريخك المرضي، ووضع خريطة طريق علاجية مخصصة.</p>
                        <a href="https://wa.me/967771447111?text=أرغب%20في%20حجز%20استشارة%20أولية%20شاملة" target="_blank" class="btn btn-primary text-white py-2 px-6 rounded-full">احجز الآن</a>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.2s;">
                        <div class="text-5xl text-[--accent-color] mb-4"><i class="fas fa-heartbeat"></i></div>
                        <h3 class="text-2xl font-bold mb-3">باقة المتابعة الصحية</h3>
                        <p class="mb-6">3 جلسات متابعة (45 دقيقة لكل جلسة) لمراقبة تقدمك، تعديل الخطة العلاجية، وتقديم الدعم المستمر لك.</p>
                         <a href="https://wa.me/967771447111?text=أرغب%20في%20الاشتراك%20بباقة%20المتابعة%20الصحية" target="_blank" class="btn btn-primary text-white py-2 px-6 rounded-full">اشترك الآن</a>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.4s;">
                        <div class="text-5xl text-[--accent-color] mb-4"><i class="fas fa-leaf"></i></div>
                        <h3 class="text-2xl font-bold mb-3">استشارة التغذية الوظيفية</h3>
                        <p class="mb-6">جلسة مركزة لمدة 60 دقيقة لوضع خطة تغذية علاجية مخصصة لمعالجة مشاكل صحية معينة مثل مشاكل الهضم أو الطاقة.</p>
                         <a href="https://wa.me/967771447111?text=أرغب%20في%20حجز%20استشارة%20التغذية%20الوظيفية" target="_blank" class="btn btn-primary text-white py-2 px-6 rounded-full">احجز الآن</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Store Section -->
        <section id="view-store" class="page-view py-20 bg-gray-50 hidden">
            <div class="container mx-auto px-6 text-center">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <h2 class="text-4xl font-bold mb-4 section-title">متجر المنتجات الشافية</h2>
                <p class="max-w-2xl mx-auto mb-12">مجموعة منتقاة بعناية من المنتجات الطبيعية والأدوية الوظيفية التي أثق بها وأوصي بها لدعم رحلتك العلاجية.</p>
                <div id="store-products-grid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2">
                        <img src="assets/images/DMSO%20.webp" alt="DMSO للجلد" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">DMSO للجلد</h3>
                            <p class="text-gray-600 mb-4">مذيب طبيعي قوي لدعم الشفاء وتخفيف الألم الموضعي.</p>
                            <p class="text-2xl font-bold text-[--primary-color] mb-4">$45</p>
                            <a href="https://wa.me/967771447111?text=أرغب%20في%20شراء%20DMSO%20للجلد" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full">اطلب عبر واتساب</a>
                        </div>
                    </div>
                    <div class="border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.1s;">
                        <img src="assets/images/Vit%20D3%20+%20K2%20.webp" alt="مكمل فيتامين D3 + K2" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">مكمل فيتامين د3 + ك2</h3>
                            <p class="text-gray-600 mb-4">لدعم صحة العظام والمناعة.</p>
                            <p class="text-2xl font-bold text-[--primary-color] mb-4">$35</p>
                            <a href="https://wa.me/967771447111?text=أرغب%20في%20شراء%20مكمل%20فيتامين%20د3%20%2B%20ك2" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full">اطلب عبر واتساب</a>
                        </div>
                    </div>
                    <div class="border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.2s;">
                        <img src="assets/images/magnesium-citrate-solaray-400-2.webp" alt="زيت الماغنيسيوم النقي" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">زيت الماغنسيوم النقي</h3>
                            <p class="text-gray-600 mb-4">للاسترخاء وتخفيف آلام العضلات.</p>
                             <p class="text-2xl font-bold text-[--primary-color] mb-4">$25</p>
                            <a href="https://wa.me/967771447111?text=أرغب%20في%20شراء%20زيت%20الماغنسيوم%20النقي" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full">اطلب عبر واتساب</a>
                        </div>
                    </div>
                    <div class="border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.3s;">
                        <img src="assets/images/بكتيرياء%20نافعة%20probiotic%20.png" alt="بروبيوتيك عالي الجودة" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">بروبيوتيك عالي الجودة</h3>
                            <p class="text-gray-600 mb-4">لدعم صحة الجهاز الهضمي والميكروبيوم.</p>
                             <p class="text-2xl font-bold text-[--primary-color] mb-4">$50</p>
                            <a href="https://wa.me/967771447111?text=أرغب%20في%20شراء%20بروبيوتيك%20عالي%20الجودة" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full">اطلب عبر واتساب</a>
                        </div>
                    </div>
                    <!-- NEW Product: Tibrah Ora – باكج صحة اللثة والأسنان -->
                    <div class="border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.4s;">
                        <img src="assets/images/اساسي 2 ).png" alt="tibrah ora | باكج صحة اللثة والأسنان" class="w-full h-56 object-cover">
                        <div class="p-6 text-right">
                            <h3 class="text-xl font-bold mb-2">tibrah ora | باكج صحة اللثة والأسنان</h3>
                            <p class="text-gray-600 mb-4">نظام متكامل لتنقية الفم وإنعاش النفس (مضمضة علاجية + بخاخ عشبي).</p>
                            <p class="text-2xl font-bold text-[--primary-color] mb-4">3300 ريال يمني</p>
                            <a href="https://wa.me/967771447111?text=أرغب%20في%20شراء%20باكج%20Tibrah%20Ora" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full">اطلب عبر واتساب</a>
                            <button class="btn btn-outline w-full mt-4 details-button" data-prod="tibrahOra">وصف المنتج</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Frequency Generator Section -->
        <section id="view-frequencies" class="page-view py-20 bg-white hidden">
            <div class="container mx-auto px-6 text-center">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <h2 class="text-4xl font-bold mb-4 section-title">مولد الترددات الشفائية</h2>
                <p class="max-w-2xl mx-auto mb-6">استمع للترددات النقية للتأمل العميق، أو اختر الموسيقى الهادئة للاسترخاء. استخدم سماعات الرأس لأفضل تأثير.</p>
                
                <div id="audio-init-prompt" class="text-center mb-8">
                    <button id="start-audio-btn" class="btn btn-primary text-white py-3 px-8 text-lg rounded-full">
                        <i class="fas fa-power-off mr-2"></i> بدء النظام الصوتي
                    </button>
                </div>

                <div id="frequency-player-container" class="bg-gray-100 p-8 rounded-xl shadow-lg max-w-5xl mx-auto hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h3 class="text-2xl font-bold mb-4">مشغل الترددات</h3>
                             <canvas id="frequency-canvas" class="w-full h-40 mb-4"></canvas>
                             <button id="stop-freq-btn" class="btn btn-secondary py-2 px-6 rounded-full w-full">إيقاف التردد</button>
                        </div>
                        <div>
                           <h3 class="text-2xl font-bold mb-4">موسيقى هادئة</h3>
                           <div id="music-player" class="bg-white p-4 rounded-lg">
                               <p id="music-title" class="font-bold text-lg">موسيقى للاسترخاء</p>
                               <p class="text-sm text-gray-500 mb-2">تأليف: Ashot Danielyan</p>
                               <audio id="background-music" loop src="https://cdn.pixabay.com/download/audio/2022/11/21/audio_a1bf8202ef.mp3"></audio>
                               <div class="flex items-center gap-4 mt-2">
                                   <button id="music-play-pause-btn" class="music-btn text-3xl text-[--primary-color]"><i class="fas fa-play"></i></button>
                                   <input id="music-volume" type="range" min="0" max="1" step="0.01" value="0.5" class="w-full">
                               </div>
                           </div>
                        </div>
                    </div>
                    <hr class="my-8">
                    <h3 class="text-2xl font-bold mb-4">ترددات النقلة الموازية (Parallel Shift)</h3>
                     <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8" id="parallel-shift-buttons">
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="7.83">
                            <span>7.83 Hz - تردد شومان</span>
                            <span class="freq-description">التجذر والتناغم مع الأرض</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="432">
                            <span>432 Hz - التناغم الكوني</span>
                             <span class="freq-description">السكينة والهدوء الداخلي</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="111">
                            <span>111 Hz - الجسر الطاقي</span>
                            <span class="freq-description">ربط العقل الواعي باللاواعي</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="222">
                            <span>222 Hz - الثقة والتوازن</span>
                             <span class="freq-description">إعادة التوازن والثقة بالمسار</span>
                        </button>
                    </div>

                    <h3 class="text-2xl font-bold mb-4">ترددات السولفيجيو العلاجية</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4" id="frequency-buttons">
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="396">
                            <span>396 Hz - تحرير الذنب</span>
                             <span class="freq-description">التخلص من الخوف والشعور بالذنب</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="417">
                            <span>417 Hz - تسهيل التغيير</span>
                             <span class="freq-description">إزالة الطاقات السلبية</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="528">
                            <span>528 Hz - التحول والمعجزات</span>
                             <span class="freq-description">إصلاح الحمض النووي (DNA)</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="639">
                             <span>639 Hz - إعادة الاتصال</span>
                            <span class="freq-description">تحسين العلاقات والتناغم</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="741">
                            <span>741 Hz - إيقاظ الحدس</span>
                            <span class="freq-description">التطهير والتعبير عن الذات</span>
                        </button>
                        <button class="freq-btn p-3 rounded-lg border-2 border-gray-200 transition bg-white" data-freq="852">
                            <span>852 Hz - العودة للروح</span>
                             <span class="freq-description">الاتصال بالنظام الروحي</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Body Map Section (SVG UPGRADE) -->
        <section id="view-body-map" class="page-view py-20 bg-white hidden">
            <div class="container mx-auto px-6">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 section-title">خريطة الجسد الشعوري</h2>
                    <p class="max-w-3xl mx-auto text-lg">انقر على أي عضو لاستكشاف الأمراض المرتبطة به وأسبابها الشعورية العميقة بناءً على مبادئ الطب الشعوري.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
                    <!-- SVG Body Map Container -->
                    <div id="body-map-svg-container" class="md:col-span-1 w-full rounded-lg shadow-lg flex justify-center items-center p-4">
                       <svg id="body-map-svg" class="w-full max-w-xs h-auto" viewBox="0 0 300 600" xmlns="http://www.w3.org/2000/svg">
                            <!-- Base Body Outline -->
                            <path d="M150 580 C 120 500, 110 400, 110 350 C 110 250, 120 200, 150 180 C 180 200, 190 250, 190 350 C 190 400, 180 500, 150 580 Z" fill="rgba(230, 211, 193, 0.2)" stroke="#ccc" stroke-width="0.5"/>
                            <path d="M150 180 C 120 180, 100 130, 150 50 C 200 130, 180 180, 150 180Z" fill="rgba(230, 211, 193, 0.2)" stroke="#ccc" stroke-width="0.5"/>
                            <!-- Organs -->
                            <path class="organ-path" data-organ="brain" d="M150,110 a55,55 0 1,0 0.1,0 Z" />
                            <path class="organ-path" data-organ="thyroid" d="M150,195 a25,12 0 0,0 0,-1 Z" />
                            <path class="organ-path" data-organ="heart" d="M150 250 C 140 240, 120 245, 125 265 S 150 280, 150 280 S 175 265, 175 265 S 160 240, 150 250 Z" />
                            <path class="organ-path" data-organ="liver" d="M125,320 a40,25 0 0,1 50,0 l-5 -30 l-40 0 l-5 30 Z" />
                            <path class="organ-path" data-organ="gut" d="M150,380 a45,30 0 1,0 0.1,0 Z M150,380 a30,20 0 1,1 0.1,0 Z" />
                            <g data-organ="adrenals" class="organ-path">
                                <path d="M120,310 a15,8 0 0,1 10,-5" />
                                <path d="M170,310 a15,8 0 0,0 -10,-5" />
                            </g>
                             <g data-organ="kidneys" class="organ-path">
                                <path d="M125 340 C 115 340, 110 370, 125 370 C 135 370, 130 340, 125 340 Z" />
                                <path d="M175 340 C 165 340, 160 370, 175 370 C 185 370, 180 340, 175 340 Z" />
                            </g>
                        </svg>
                    </div>

                    <!-- Info Panel -->
                    <div id="body-map-info-container" class="md:col-span-2">
                        <div id="body-map-info" class="bg-white p-8 rounded-xl shadow-lg opacity-0 transform translate-y-5 h-full">
                            <h3 id="organ-name" class="text-3xl font-bold mb-4 text-[--primary-color]">حدد عضواً للبدء</h3>
                            <div id="organ-details">
                                <p class="text-gray-600">انقر على رسم الجسم لاكتشاف المزيد.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Quizzes Section (NEW) -->
        <section id="view-quizzes" class="page-view py-20 bg-gray-50 hidden">
             <div class="container mx-auto px-6">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 section-title">التقييمات الصحية التفاعلية</h2>
                    <p class="max-w-3xl mx-auto text-lg">هذه الاستبيانات ليست تشخيصاً طبياً، بل هي أدوات لمساعدتك على زيادة وعيك بصحتك وتحديد المجالات التي قد تحتاج إلى اهتمام. ناقش النتائج دائماً مع مختص.</p>
                </div>
                
                <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold mb-3 text-[--primary-dark]">اختبار الإرهاق الكظري</h3>
                        <p class="text-gray-600 mb-4">هل تشعر بالتعب المستمر وصعوبة في التعامل مع الإجهاد؟ قد تكون غدتك الكظرية بحاجة إلى دعم.</p>
                        <button class="btn btn-primary text-white py-2 px-6 rounded-full quiz-start-btn" data-quiz="adrenal-fatigue">ابدأ الاختبار</button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold mb-3 text-[--primary-dark]">تقييم الأمعاء المتسربة</h3>
                        <p class="text-gray-600 mb-4">اكتشف ما إذا كانت مشاكل مثل الانتفاخ، الحساسية الغذائية، أو المشاكل الجلدية قد تكون مرتبطة بصحة أمعائك.</p>
                        <button class="btn btn-primary text-white py-2 px-6 rounded-full quiz-start-btn" data-quiz="leaky-gut">ابدأ الاختبار</button>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold mb-3 text-[--primary-dark]">احسب درجة السمية في جسمك</h3>
                        <p class="text-gray-600 mb-4">قيّم تعرضك للسموم البيئية وقدرة جسمك على التخلص منها.</p>
                        <button class="btn btn-primary text-white py-2 px-6 rounded-full quiz-start-btn" data-quiz="toxicity-score">ابدأ الاختبار</button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow">
                        <h3 class="text-2xl font-bold mb-3 text-[--primary-dark]">اختبار لوشير للألوان</h3>
                        <p class="text-gray-600 mb-4">اختر الألوان حسب تفضيلك للكشف عن جوانب من حالتك النفسية الحالية.</p>
                        <button class="btn btn-primary text-white py-2 px-6 rounded-full quiz-start-btn" data-quiz="luscher-color-test">ابدأ الاختبار</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Journal Section (NEW) -->
        <section id="view-journal" class="page-view py-20 bg-white hidden">
            <div class="container mx-auto px-6">
                <div id="journal-content-container">
                     <div class="text-right mb-12">
                         <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                              <i class="fas fa-arrow-right-long ml-2"></i>
                              الرجوع إلى لوحة التحكم
                           </button>
                     </div>
                    <div class="text-center mb-12">
                        <h2 class="text-4xl font-bold mb-4 section-title">مفكرة الأعراض والمزاج</h2>
                        <p class="max-w-3xl mx-auto text-lg">أداة قوية لتصبح محققاً في رحلتك الصحية. سجّل تتبعك اليومي هنا لاكتشاف الروابط بين نمط حياتك وما تشعر به.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- New Entry Form -->
                        <div class="md:col-span-1 bg-gray-50 p-6 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold mb-4 text-center">إدخال اليوم</h3>
                            <form id="journal-form">
                                <div class="mb-4">
                                    <label for="entry-date">التاريخ</label>
                                    <input type="date" id="entry-date" class="w-full p-2 border rounded-md" required>
                                </div>
                                <div class="mb-4">
                                    <label for="mood-rating">المزاج (1=سيء, 10=ممتاز)</label>
                                    <input type="range" id="mood-rating" min="1" max="10" value="5" class="w-full">
                                </div>
                                 <div class="mb-4">
                                    <label for="energy-rating">الطاقة (1=منهك, 10=حيوي)</label>
                                    <input type="range" id="energy-rating" min="1" max="10" value="5" class="w-full">
                                </div>
                                 <div class="mb-4">
                                    <label for="sleep-quality">جودة النوم (ساعات)</label>
                                    <input type="number" id="sleep-quality" min="0" max="12" step="0.5" class="w-full p-2 border rounded-md" placeholder="e.g., 7.5">
                                </div>
                                 <div class="mb-4">
                                    <label for="symptoms-today">الأعراض اليوم</label>
                                    <textarea id="symptoms-today" rows="3" class="w-full p-2 border rounded-md" placeholder="صداع، انتفاخ، ألم مفاصل..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary text-white w-full py-3 rounded-full">حفظ الإدخال</button>
                            </form>
                        </div>
                        <!-- Entries & Charts -->
                        <div class="md:col-span-2">
                             <h3 class="text-2xl font-bold mb-4 text-center">تحليل الأنماط</h3>
                             <div class="bg-gray-50 p-6 rounded-xl shadow-lg mb-6">
                                 <canvas id="journal-chart"></canvas>
                             </div>
                             <h3 class="text-2xl font-bold mb-4 text-center">سجل إدخالاتي</h3>
                             <div id="journal-entries-container" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                                 <!-- Entries will be loaded here -->
                             </div>
                        </div>
                    </div>
                </div>

                 <div id="journal-login-prompt" class="hidden text-center py-16">
                     <div class="bg-white max-w-2xl mx-auto p-8 rounded-xl shadow-lg">
                         <i class="fas fa-lock text-5xl text-[--accent-color] mb-4"></i>
                         <h3 class="text-2xl font-bold mb-3">هذه الميزة حصرية للأعضاء</h3>
                         <p class="text-gray-600 mb-6">يرجى تسجيل الدخول للوصول إلى مفكرة الأعراض والمزاج الخاصة بك وحفظ تقدمك.</p>
                         <button id="login-for-journal-btn" class="btn btn-primary text-white py-2 px-8 rounded-full">تسجيل الدخول</button>
                     </div>
                 </div>
            </div>
        </section>
        
        <!-- Premium Content / Patient File Section -->
        <section id="view-premium-content" class="page-view py-20 hidden">
            <div class="container mx-auto px-6 text-center">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <h2 id="welcome-message" class="text-4xl font-bold mb-4 section-title">مرحباً بك في أسرتنا</h2>
                <p class="max-w-2xl mx-auto mb-12">هذه مساحتك الحصرية. هنا ستجد المحتوى الخاص وجميع نتائجك المحفوظة من أدواتنا الذكية.</p>
                <div id="patient-file-content" class="bg-white p-8 rounded-xl shadow-inner max-w-4xl mx-auto text-right">
                    <h3 class="text-2xl font-bold mb-6">سجلاتي المحفوظة</h3>
                    <div id="saved-results-container" class="space-y-6">
                        <p>الرجاء تسجيل الدخول لعرض سجلاتك المحفوظة.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Blog Section -->
        <section id="view-blog" class="page-view py-20 bg-gray-50 hidden">
             <div class="container mx-auto px-6 text-center">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="dashboard">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى لوحة التحكم
                     </button>
                 </div>
                <h2 class="text-4xl font-bold mb-4 section-title">من وحي المدونة</h2>
                <p class="max-w-2xl mx-auto mb-12">مقالات ورؤى لمساعدتك على فهم جسدك بشكل أفضل واتخاذ قرارات صحية مستنيرة.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 text-right">
                    <div class="bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2">
                        <img src="https://images.unsplash.com/photo-1498837167922-ddd27525d352?q=80&w=2070&auto=format&fit=crop" alt="صورة طعام صحي" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-3">هل أمعاؤك هي سبب تقلبات مزاجك؟</h3>
                            <p class="text-gray-600 mb-4">اكتشف العلاقة المدهشة بين صحة الجهاز الهضمي وصحتك النفسية.</p>
                            <a href="#" class="read-more-btn font-bold text-[--primary-color] hover:underline" data-postid="gut-brain">اقرأ المزيد &larr;</a>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.2s;">
                        <img src="https://images.unsplash.com/photo-1599301934984-1d2741913a5f?q=80&w=2070&auto=format&fit=crop" alt="صورة امرأة تتأمل" class="w-full h-56 object-cover">
                        <div class="p-6">
                             <h3 class="text-xl font-bold mb-3">قوة التنفس: كيف تهدئ جهازك العصبي في 5 دقائق</h3>
                            <p class="text-gray-600 mb-4">تعلم تقنية تنفس بسيطة وفعالة لخفض التوتر والقلق فوراً.</p>
                            <a href="#" class="read-more-btn font-bold text-[--primary-color] hover:underline" data-postid="breathing">اقرأ المزيد &larr;</a>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 fade-in-up hover:-translate-y-2" style="animation-delay: 0.4s;">
                        <img src="https://images.unsplash.com/photo-1476837579993-f1d3948f17c2?q=80&w=2070&auto=format&fit=crop" alt="صورة توابل وأعشاب" class="w-full h-56 object-cover">
                        <div class="p-6">
                           <h3 class="text-xl font-bold mb-3">أفضل 3 مكملات غذائية لمكافحة الالتهابات</h3>
                            <p class="text-gray-600 mb-4">دليلي لاختيار المكملات الأكثر فعالية لدعم صحتك العامة.</p>
                            <a href="#" class="read-more-btn font-bold text-[--primary-color] hover:underline" data-postid="supplements">اقرأ المزيد &larr;</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Single Post View -->
        <section id="view-single-post" class="page-view py-20 bg-white hidden">
            <div class="container mx-auto px-6 max-w-4xl">
                 <div class="text-right mb-12">
                     <button class="nav-link font-bold text-[--primary-color] hover:text-[--accent-color] transition-colors" data-view="blog">
                         <i class="fas fa-arrow-right-long ml-2"></i>
                         الرجوع إلى المدونة
                     </button>
                 </div>
                 <article>
                     <h1 id="post-title" class="text-4xl md:text-5xl font-bold mb-4 text-center section-title"></h1>
                     <img id="post-image" src="" alt="صورة المقال" class="w-full h-96 object-cover rounded-xl shadow-lg my-8">
                     <div id="post-content" class="prose lg:prose-xl max-w-none text-right"></div>
                 </article>
            </div>
        </section>
        
        <!-- FAQ Section (NEW) -->
        <section class="py-20 bg-secondary-color">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl font-bold mb-12 text-center section-title">أسئلة شائعة</h2>
                <div class="max-w-4xl mx-auto faq-section">
                    <details>
                        <summary>متى يُنصح باستخدام أداة التشخيص الآلي؟</summary>
                        <p class="mt-4 text-gray-700">أداة التشخيص الآلي مصممة لتكون نقطة بداية استكشافية عندما تشعر بأعراض غير واضحة أو متعددة. إنها تساعد في ربط الأعراض الجسدية بالمشاعر ونمط الحياة لتقديم رؤية شمولية محتملة، ولكنها لا تغني أبداً عن استشارة طبية متخصصة لتأكيد التشخيص.</p>
                    </details>
                    <details>
                        <summary>ما الفرق بين "خطة علاجية" و"تشخيص"؟</summary>
                        <p class="mt-4 text-gray-700">التشخيص يهدف إلى تحديد "ماذا" يحدث في جسمك بناءً على الأعراض التي تقدمها. أما الخطة العلاجية فتهدف إلى تحديد "كيف" يمكن معالجة هذا التشخيص أو مجموعة الأعراض من خلال اقتراح بروتوكول علاجي يتضمن تغذية، مكملات، ونصائح حياتية. يمكنك استخدام نتيجة التشخيص كمدخل لطلب خطة علاجية.</p>
                    </details>
                     <details>
                        <summary>هل "خريطة الجسد الشعوري" علمية؟</summary>
                        <p class="mt-4 text-gray-700">خريطة الجسد الشعوري مبنية على مبادئ الطب الشعوري والطب الألماني الحديث (GNM)، وهي مدارس ترى أن لكل مرض جسدي جذر أو صدمة شعورية مرتبطة به. بينما لا تزال هذه الأفكار في طور البحث في الأوساط العلمية التقليدية، فإنها تقدم منظوراً قوياً للشفاء الذاتي وفهم أعمق لرسائل أجسادنا.</p>
                    </details>
                    <details>
                        <summary>هل يمكنني الاعتماد على بروتوكول الشعر فقط؟</summary>
                        <p class="mt-4 text-gray-700">البروتوكول المقدم هو مجموعة من أفضل الممارسات الشمولية التي أثبتت فعاليتها للكثيرين. ومع ذلك، تختلف الاستجابة من شخص لآخر. للحصول على أفضل النتائج، يُفضل دمج البروتوكول مع نظام غذائي صحي، إدارة للتوتر، ونوم كافٍ. هو جزء من منظومة متكاملة وليس حلاً سحرياً منفرداً.</p>
                    </details>
                </div>
            </div>
        </section>

    </main>
    
    <!-- Footer -->
    <footer id="contact" class="bg-gray-800 text-white pt-20 pb-8">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-3xl font-bold mb-4">هل أنت مستعد لبدء رحلة الشفاء؟</h2>
            <p class="max-w-xl mx-auto mb-8">تواصل معي اليوم عبر واتساب لحجز استشارتك الأولى، أو تابعني على وسائل التواصل الاجتماعي لمحتوى يومي ملهم.</p>
            <a href="https://wa.me/967771447111?text=أهلاً%20د.%20عمر،%20أرغب%20في%20الاستفسار%20عن%20جلسات%20العلاج%20الشمولي" target="_blank" class="btn btn-primary text-white text-xl py-3 px-8 rounded-full inline-block mb-12"><i class="fab fa-whatsapp"></i> تواصل معي عبر واتساب</a>
            
            <div class="flex justify-center space-x-6 text-3xl mb-8">
                <a href="https://www.instagram.com/dr.omr369" target="_blank" class="hover:text-[--accent-color] transition"><i class="fab fa-instagram"></i></a>
                <a href="https://www.facebook.com/dr.omr369" target="_blank" class="hover:text-[--accent-color] transition"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.tiktok.com/@dr.omr369" target="_blank" class="hover:text-[--accent-color] transition"><i class="fab fa-tiktok"></i></a>
            </div>

            <div class="border-t border-gray-700 pt-6">
                 <p>&copy; 2025 د. عمر العماد | جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="back-to-top-btn" class="hidden fixed bottom-5 right-5 bg-[--primary-color] text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-2xl transition-opacity duration-300 hover:bg-[--primary-dark]">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/967771447111" class="whatsapp-float" target="_blank" aria-label="تواصل معنا عبر واتساب">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Modals -->
    <div id="tool-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 opacity-0">
        <div id="modal-content" class="bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300"></div>
    </div>
    
    <div id="quiz-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4 opacity-0">
        <div id="quiz-modal-content" class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300"></div>
    </div>


    <div id="hair-protocol-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[110] p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative text-right">
            <button class="absolute top-4 left-4 text-2xl text-gray-500 hover:text-gray-800" onclick="closeModal('hair-protocol-modal')">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-center text-[--primary-color]">البروتوكول الشمولي لعلاج الشعر</h3>
            <div class="text-right space-y-4">
                <p class="text-center text-gray-600 mb-4">بروتوكول علاجي شامل لتأخير الشيب وتحفيز تصبغ الشعر وتقليل التساقط.</p>
                
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 1: الزيوت العلاجية الموضعية (2-3 مرات أسبوعياً)</h4>
                    <p><strong>التركيبة:</strong></p>
                    <ul class="list-disc list-inside pr-4">
                        <li>زيت إكليل الجبل: 10 مل</li>
                        <li>زيت النعناع: 5 مل</li>
                        <li>زيت الليمون: 5 مل</li>
                        <li>زيت السمسم (كزيت حامل): 30 مل</li>
                        <li>زيت الخروع (اختياري للتكثيف): 10 مل</li>
                        <li>كيروسين طبي أو بارافين طبي: 5 مل</li>
                    </ul>
                    <p class="mt-2"><strong>طريقة الاستخدام:</strong> امزج المكونات، دفئها قليلاً، دلك فروة الرأس لـ 5-10 دقائق، واتركها لساعتين على الأقل قبل غسلها بشامبو طبيعي.</p>
                </div>

                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 2: مكملات غذائية يومية</h4>
                     <ul class="list-disc list-inside pr-4">
                        <li><strong>صباحًا بعد الفطور:</strong> Zinc (30-50 ملغ) مع Vitamin C (Liposomal) (500-1000 ملغ)</li>
                        <li><strong>بعد ساعتين من الزنك:</strong> Copper (2-3 ملغ)</li>
                        <li><strong>صباحًا أو مساءً:</strong> Fo-Ti (كبسولة 500-1000 ملغ) - <span class="text-red-500 font-bold">ينصح بعمل تحليل وظائف كبد.</span></li>
                    </ul>
                </div>
                
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 3: قناع الشعر الطبيعي (مرة أسبوعياً)</h4>
                    <p><strong>التركيبة:</strong> ملعقة كبيرة سدر بودرة، ملعقة صغيرة عكبر نحل، نصف ملعقة صغيرة بذور الخلة المطحونة، 2 ملعقة كبيرة خل تفاح طبيعي، وماء دافئ للعجن.</p>
                    <p class="mt-2"><strong>طريقة الاستخدام:</strong> يوضع على الفروة والشعر لمدة 30-60 دقيقة ثم يغسل جيداً.</p>
                </div>

                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 4: مادة ORMUS</h4>
                    <p><strong>الجرعة:</strong> ملعقة صغيرة يومياً صباحاً على معدة فارغة من مصدر موثوق.</p>
                    <p><strong>الفوائد:</strong> يزيد التركيز، يوازن الطاقات، ويحفز تجدد الخلايا الصبغية.</p>
                    <p class="text-red-500 font-bold mt-2">تحذير: لا تستخدم ORMUS مع أدوية نفسية أو مناعية دون استشارة طبيب.</p>
                </div>

                <div class="p-4 bg-green-50 rounded-lg border-r-4 border-green-500">
                    <h4 class="font-bold text-lg mb-2 text-green-800">نصائح عامة داعمة</h4>
                    <ul class="list-disc list-inside pr-4">
                        <li>اتبع نظامًا غذائيًا غنيًا بفيتامينات B12، حمض الفوليك، والسيليكا.</li>
                        <li>خفف التوتر، لأن الإجهاد يزيد من الشيب.</li>
                        <li>تجنب الصبغات الكيميائية القوية أثناء البروتوكول.</li>
                        <li>أكثر من شرب العصائر الخضراء.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- START Hemorrhoid Protocol Modal -->
    <div id="hemorrhoid-protocol-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[110] p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative text-right">
            <button class="absolute top-4 left-4 text-2xl text-gray-500 hover:text-gray-800" onclick="closeModal('hemorrhoid-protocol-modal')">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-center text-[--primary-color]">🌿 بروتوكول طِبرة العميق لعلاج البواسير – Ṭibrah Hemorrhoid Healing Protocol</h3>
            <div class="text-right space-y-4">
                <p class="italic bg-yellow-50 p-4 rounded-lg border-r-4 border-yellow-400 leading-relaxed">هذا البروتوكول صُمّم ليكون شاملًا، يغطي جوانب مختلفة من علاج البواسير — من الأدوية الحديثة، إلى الأعشاب، إلى المكملات، إلى العلاج الطاقي والروحي.<br><br>لكن الحقيقة البسيطة هي:<br><strong>لستَ بحاجة أن تطبّق كل شيء دفعة واحدة.</strong><br><br><em>ابدأ بما يناسبك، بما ترتاح له، بما تستطيع فعله اليوم.</em> قد تختار أن تبدأ بالمغطس فقط، أو بالكريم الطبيعي، أو بالمكملات… وكلها أبواب صادقة نحو الشفاء.<br><br><strong>استمع إلى جسدك، وثق بأن كل خطوة صغيرة، إن وُضعت بنيّة، تُحدث فرقًا.</strong><br>🌱 الشفاء ليس سباقًا… بل عودة هادئة إلى ذاتك.</p>

                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🎯 الخطوة 1 | العلاجات التقليدية الحديثة (Conventional Medicine)</h4><ol class="list-decimal list-inside pr-4 space-y-1"><li><strong>أقراص دافلون (Daflon 1000mg)</strong> – قرص واحد يومياً، لتحسين الدورة الوريدية وتخفيف الاحتقان.</li><li><strong>مرهم نيوهيلار (Neo-Healar)</strong> – مرتين يومياً، يقلل الالتهاب والتورم.</li><li><strong>تحاميل بروكتوجليفينول (Procto-Glyvenol)</strong> – تحميلة مساءً لتسكين الألم الداخلي والتورم.</li><li><strong>تقنيات غير جراحية (للحالات المتقدمة):</strong><ul class="list-disc list-inside pr-6"><li>ربط بالشريط المطاطي</li><li>الليزر (Hemorrhoidoplasty)</li><li>الترددات الراديوية (RFA)</li></ul><span class="text-sm text-red-600">تُجرى جميعها تحت إشراف طبي مختص.</span></li></ol></div><!-- الخطوة 2 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🍀 الخطوة 2 | العلاج بالأعشاب الطبية (Herbal Medicine)</h4><p class="mb-2">شاي أو كبسولات مرتين يومياً حسب التوفر:</p><ul class="list-disc list-inside pr-4 space-y-1"><li><strong>Witch Hazel bark:</strong> قابض للأوعية، يوقف النزيف.</li><li><strong>Catnip:</strong> يريح عضلات الأمعاء ويقلل التشنجات.</li><li><strong>Yellow Dock:</strong> يعالج الإمساك ويحسّن الهضم.</li><li><strong>White Oak Bark:</strong> قابض للأنسجة ويسرّع الشفاء.</li></ul><p class="mt-3 font-semibold">خلطة الأعشاب (مرتين يومياً):</p><ul class="list-disc list-inside pr-4 space-y-1"><li>Bayberry</li><li>Alum Root</li><li>Mullein</li><li>Pilewort</li><li>Yarrow</li></ul><p class="mt-2 text-sm text-gray-700">تُسرّع شفاء النزيف والالتهاب.</p><p class="mt-3"><strong>Bloodroot (جذر الدم):</strong> منشط مناعي قوي – 10 قطرات في كوب ماء يومياً لمدة أسبوعين فقط، وتحت إشراف مختص.</p></div><!-- الخطوة 3 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🌿 الخطوة 3 | مكملات الأورثوموليكيولر (Orthomolecular Supplements)</h4><p class="mb-2">لمدة 4–8 أسابيع:</p><ul class="list-disc list-inside pr-4 space-y-1"><li>فيتامين C – 1000mg مرتين يومياً</li><li>روتين – Rutin 500mg مرتين</li><li>فيتامين E (Tocotrienols) – 400 IU يومياً</li><li>Zinc Bisglycinate – 25mg يومياً</li><li>Horse Chestnut – 250mg مرتين</li><li>Grape Seed Extract – 200mg مرتين</li><li>Liquid Chlorophyll – 10ml مرتين</li><li>Bromelain – 500mg مرتين على معدة فارغة</li></ul></div><!-- الخطوة 4 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🧴 الخطوة 4 | العلاجات الموضعية غير التقليدية (Topical Alternative)</h4><ol class="list-decimal list-inside pr-4 space-y-2"><li><strong>كريم طِبرة بالكيروسين للبواسير:</strong><ul class="list-disc list-inside pr-4"><li>10ml كيروسين طبي نقي</li><li>10ml زيت خروع</li><li>10ml زيت جوز هند</li><li>3 قطرات Tea Tree Oil</li><li>3 قطرات Lavender Oil</li></ul><span class="text-sm">يُستخدم مرتين يومياً.</span></li><li><strong>مرهم DMSO العميق:</strong><ul class="list-disc list-inside pr-4"><li>70% DMSO</li><li>30% جل ألوفيرا</li><li>500mg كركمين لكل 50ml</li></ul><span class="text-sm">يُستخدم مرة مساءً.</span></li><li><strong>كمادات Witch Hazel وWhite Oak:</strong> 15 دقيقة يومياً بمغلي مبرد.</li></ol></div><!-- الخطوة 5 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">💧 الخطوة 5 | المغطس العلاجي (Sitz Bath)</h4><ul class="list-disc list-inside pr-4"><li>10ml كيروسين طبي</li><li>10ml زيت النيم</li><li>5 قطرات Tea Tree Oil</li><li>5 قطرات Cypress Oil</li></ul><p class="mt-2 text-sm">يُستخدم يومياً 15–20 دقيقة.</p></div><!-- الخطوة 6 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🍏 الخطوة 6 | التغذية العلاجية الواعية</h4><ul class="list-disc list-inside pr-4"><li>ألياف نباتية (سيليوم، شيا، كتان)</li><li>3 لتر ماء يومياً</li><li>تجنّب السكر، الألبان، القمح</li></ul></div><!-- الخطوة 7 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🚶‍♂️ الخطوة 7 | نمط الحياة الواعي</h4><ul class="list-disc list-inside pr-4"><li>تمارين تنفس 10 دقائق</li><li>مشي 20 دقيقة</li><li>رفع الساقين أثناء النوم</li><li>تجنّب الجلوس الطويل</li></ul></div><!-- الخطوة 8 --><div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-lg mb-2 text-[--primary-dark]">🌀 الخطوة 8 | معالجة الجذر الشعوري والطاقي</h4><ul class="list-disc list-inside pr-4"><li><strong>تأمل تفريغ الحوض – Pelvic Release Meditation</strong></li><li><strong>رسالة للقولون:</strong> "أنا آسف لأنني كتمت..."</li></ul><p class="mt-2 text-sm">الشفاء أحيانًا في إطلاق الحزن، لا فقط البراز.</p></div><!-- نصائح --><div class="p-4 bg-green-50 rounded-lg border-r-4 border-green-500"><h4 class="font-bold text-lg mb-2 text-green-800">⚡ نصائح هامة</h4><ul class="list-disc list-inside pr-4"><li>DMSO قوي الاختراق، نظّف المنطقة جيدًا قبل استخدامه.</li><li>Bloodroot لا يُستخدم إلا بإشراف مختص.</li><li>كريم طِبرة فعّال ويُستخدم مع العلاجات التقليدية.</li><li>دافلون علميًا مثبت.</li></ul></div><div class="p-4 bg-red-50 rounded-lg border-r-4 border-red-500"><h4 class="font-bold text-lg mb-2 text-red-800">🚨 تحذيرات</h4><ul class="list-disc list-inside pr-4"><li>لا تستخدم مواد غير موثوقة.</li><li>راقب التحسس من الكيروسين وDMSO.</li><li>استشر مختصًا عند استخدام Bloodroot.</li></ul></div><div class="p-4 bg-blue-50 rounded-lg border-r-4 border-blue-500"><h4 class="font-bold text-lg mb-2 text-blue-800">✅ الفوائد المتوقعة</h4><ul class="list-disc list-inside pr-4"><li>وقف سريع للنزيف</li><li>تقليل الألم والحرقان</li><li>شفاء عميق للبواسير الداخلية والخارجية</li><li>تحسين مناعة وصحة الهضم</li></ul></div><p class="text-center font-semibold text-[--primary-dark]">🌟 هذا بروتوكول علاجي شامل يجمع بين الطب التقليدي والحديث والعشبي والتكميلي – للوصول إلى شفاء جذري واعٍ.<br>بالشفاء التام بإذن الله. 🌿✨</p>

            </div>
        </div>
    </div>
    <!-- END Hemorrhoid Protocol Modal -->

    <!-- Notification Toast -->
    <div id="notification-toast" class="hidden fixed top-20 right-5 py-3 px-6 rounded-lg shadow-xl z-[150] transition-transform duration-500 translate-x-full">
        <p id="notification-message" class="text-white"></p>
    </div>
    
    <script>
  window.openModal = id => document.getElementById(id)?.classList.remove('hidden');
  window.closeModal = id => document.getElementById(id)?.classList.add('hidden');
</script>

<script type="module">
        // --- SDK IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =========================================================================
        // !! ‫مفتاح API المحدث !!
        // =========================================================================
        const GEMINI_API_KEY = "AIzaSyCaev1GHwaZ7EqoxIyvRmgLehWs6Hq1gDw"; // <-- تم تحديث المفتاح هنا
        // =========================================================================

        // --- FIREBASE CONFIG ---
        const firebaseConfig = typeof __firebase_config !== 'undefined'
          ? JSON.parse(__firebase_config)
          : {
               apiKey: "AIzaSyBi2y64T-X1FNwbhv8ATQnF5xTZ3Pq4neg", // Fallback for local testing
               authDomain: "tibrasoul.firebaseapp.com",
               projectId: "tibrasoul",
               storageBucket: "tibrasoul.appspot.com",
               messagingSenderId: "920755760709",
               appId: "1:920755760709:web:778cd12e6edbd199827d2c"
            };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- FIREBASE INITIALIZATION ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        // --- GLOBAL STATE ---
        let currentUser = null;
        let wheelChart;
        let journalChart; 

        // --- APP INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            initSmartTools();
            initFrequencyGenerator();
            initGeneralUI();
            initNavigation();
            initCreativeEffects();
            initBlog();
            initWheelOfLife();
            initAudioPlayer();
            initBodyMap(); 
            initQuizzes(); 
            initJournal(); 
            showView('hero');
        });

        // --- NAVIGATION MODULE ---
        function initNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const viewName = link.dataset.view;
                    if (viewName) {
                        document.getElementById('mobile-menu').classList.add('hidden');
                        showView(viewName);
                    }
                });
            });
        }

        function showView(viewId) {
             document.querySelectorAll('.page-view').forEach(view => {
                 view.classList.add('hidden');
             });
             const targetView = document.getElementById('view-' + viewId);
             if(targetView) {
                 // Special case: when showing hero, also show featured services section below it
                 if(viewId === 'hero') {
                     const feat = document.getElementById('featured-services');
                     if(feat) feat.classList.remove('hidden');
                 }
                 targetView.classList.remove('hidden');
                 // Smoothly scroll to the revealed view so the user sees the change
                 targetView.scrollIntoView({behavior: 'smooth'});

                 const elementsToAnimate = targetView.querySelectorAll('.fade-in-up');
                 elementsToAnimate.forEach(el => el.classList.remove('is-visible'));
                 setTimeout(() => {
                     elementsToAnimate.forEach(el => {
                         el.classList.add('is-visible');
                     });
                 }, 100);
             }
        }

        // --- NOTIFICATION MODULE ---
        const notificationToast = document.getElementById('notification-toast');
        const notificationMessage = document.getElementById('notification-message');
        let notificationTimeout;
        function showNotification(message, type = 'error', duration = 4000) {
            if (notificationTimeout) clearTimeout(notificationTimeout);
            notificationMessage.textContent = message;
            notificationToast.className = 'fixed top-20 right-5 py-3 px-6 rounded-lg shadow-xl z-[150] transition-all duration-500 transform text-white';
            if (type === 'success') {
                notificationToast.classList.add('bg-green-500');
            } else if (type === 'warning') {
                notificationToast.classList.add('bg-yellow-500');
            } else {
                notificationToast.classList.add('bg-red-600');
            }
            notificationToast.classList.remove('hidden');
            notificationToast.classList.add('translate-x-full');
            setTimeout(() => {
                notificationToast.classList.remove('translate-x-full');
            }, 10);
            notificationTimeout = setTimeout(() => {
                notificationToast.classList.add('translate-x-full');
                 setTimeout(() => notificationToast.classList.add('hidden'), 500);
            }, duration);
        }

        // --- AUTHENTICATION MODULE ---
        function initAuth() {
            const loginBtns = [
                document.getElementById('login-btn'), 
                document.getElementById('login-btn-mobile'),
                document.getElementById('login-for-journal-btn')
            ];
            
            onAuthStateChanged(auth, user => {
                currentUser = user;
                const isLoggedIn = !!user;
                
                document.getElementById('login-btn').classList.toggle('hidden', isLoggedIn);
                document.getElementById('login-btn-mobile').classList.toggle('hidden', isLoggedIn);
                document.getElementById('profile-section-nav').classList.toggle('hidden', !isLoggedIn);
                document.getElementById('profile-section-nav').classList.toggle('flex', isLoggedIn);
                document.getElementById('profile-link-mobile').classList.toggle('hidden', !isLoggedIn);

                if (isLoggedIn) {
                    document.getElementById('user-avatar').src = user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM1YTZlNWEiLz4KPHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjIwIiBmaWxsPSJ3aGl0ZSI+VTwvdGV4dD4KPC9zdmc+Cg==';
                    document.getElementById('welcome-message').textContent = `مرحباً بك في أسرتنا، ${user.displayName || 'صديقي'}`;
                    loadPatientFileData();
                    toggleJournalView(true);
                    loadJournalEntries(); 
                } else {
                    document.getElementById('saved-results-container').innerHTML = '<p>الرجاء تسجيل الدخول لعرض سجلاتك المحفوظة.</p>';
                    toggleJournalView(false);
                }
            });

            const handleLogin = () => {
                signInWithPopup(auth, provider).catch(error => {
                    console.error("Google Login Error:", error);
                    showNotification("فشل تسجيل الدخول. يرجى المحاولة مرة أخرى.", "error");
                });
            }
            loginBtns.forEach(btn => {
                if(btn) btn.addEventListener('click', handleLogin)
            });
        }
        
        // --- FIRESTORE MODULE ---
        async function saveResultToFirestore(toolName, resultData) {
            if (!currentUser) {
                showNotification('الرجاء تسجيل الدخول لحفظ نتائجك.', 'warning'); 
                return;
            }
            const resultId = `${toolName.replace(/\s+/g, '-')}-${new Date().getTime()}`;
            const resultRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'toolResults', resultId);
            
            try {
                await setDoc(resultRef, {
                    tool: toolName,
                    data: resultData,
                    createdAt: new Date()
                });
                const saveBtn = document.getElementById('save-result-btn') || document.getElementById('save-wheel-result-btn');
                if(saveBtn) {
                   saveBtn.textContent = 'تم الحفظ بنجاح!';
                   saveBtn.disabled = true;
                }
                showNotification('تم حفظ النتيجة بنجاح في ملفك!', 'success');
                loadPatientFileData();
            } catch (error) {
                console.error("Error saving document: ", error);
                showNotification('حدث خطأ أثناء حفظ النتيجة.', 'error');
            }
        }

        async function loadPatientFileData() {
            if (!currentUser) return;
            const container = document.getElementById('saved-results-container');
            container.innerHTML = '<p>جاري تحميل سجلاتك...</p>';
            try {
                const resultsCol = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'toolResults');
                const q = query(resultsCol, limit(50));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    container.innerHTML = '<p>لا توجد نتائج محفوظة بعد. استخدم إحدى الأدوات الذكية واحفظ النتيجة لتظهر هنا.</p>';
                    return;
                }
                
                const results = [];
                querySnapshot.forEach(doc => {
                    results.push(doc.data());
                });

                results.sort((a, b) => b.createdAt.toDate().getTime() - a.createdAt.toDate().getTime());
                
                let html = '';
                results.forEach(result => {
                    html += `
                        <div class="p-4 bg-gray-50 border-r-4 border-gray-300 rounded-md">
                            <h4 class="font-bold text-lg">${result.tool}</h4>
                            <p class="text-sm text-gray-500 mb-2">تاريخ الحفظ: ${result.createdAt.toDate().toLocaleString('ar-EG')}</p>
                            <div class="text-gray-700 whitespace-pre-wrap">${result.data}</div>
                        </div>`;
                });
                container.innerHTML = html;
            } catch (error) {
                console.error("Error loading patient data:", error);
                container.innerHTML = '<p class="text-red-500">حدث خطأ أثناء تحميل سجلاتك. يرجى المحاولة مرة أخرى.</p>';
            }
        }
        
        // --- Central API Request Handler ---
        async function handleApiRequest(prompt, resultsDivId, apiKey) {
            const resultsDiv = document.getElementById(resultsDivId);
            if (!resultsDiv) {
                console.error(`Element with ID ${resultsDivId} not found.`);
                return null;
            }
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.style.opacity = '1';
            resultsDiv.innerHTML = `<div class="ai-loader"><div class="ai-loader-dots"><div class="dot1"></div><div class="dot2"></div><div class="dot3"></div></div><p class="mt-4 text-[--primary-color]">جاري التحليل...</p></div>`;
            
            if (!apiKey || apiKey === "YOUR_API_KEY_HERE" || apiKey.length < 30) {
                showNotification("مفتاح Google API غير موجود أو غير صحيح. يرجى إضافته في الكود.", "error");
                resultsDiv.innerHTML = `<p class="text-center text-red-500">خطأ: مفتاح Google API مطلوب لتشغيل هذه الأداة.</p>`;
                return null;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error Response:", errorData);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                }
                const data = await response.json();
                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                    return data.candidates[0].content.parts[0].text;
                } else { throw new Error("Invalid API response structure"); }
            } catch (error) {
                console.error("API Request Error:", error);
                resultsDiv.innerHTML = `<p class="text-center text-red-500">حدث خطأ: ${error.message}. يرجى التحقق من مفتاح API وصلاحياته.</p>`;
                return null;
            }
        }


        // --- SMART TOOLS MODULE ---
        function initSmartTools() {
            const toolModal = document.getElementById('tool-modal');
            const modalContent = document.getElementById('modal-content');
            
            const showModal = (content) => {
                modalContent.innerHTML = content;
                toolModal.classList.remove('hidden');
                setTimeout(() => {
                    toolModal.classList.add('is-open');
                    modalContent.parentElement.classList.add('scale-100');
                }, 10);
                const closeButton = modalContent.querySelector('.close-modal-btn');
                if (closeButton) closeButton.addEventListener('click', hideModal);
            };

            const hideModal = () => {
                toolModal.classList.remove('is-open');
                modalContent.parentElement.classList.remove('scale-100');
                setTimeout(() => {
                    toolModal.classList.add('hidden');
                    modalContent.innerHTML = '';
                }, 300);
            };
            
            toolModal.addEventListener('click', e => {
                if (e.target === toolModal) hideModal();
            });

            document.querySelectorAll('.smart-tool-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const tool = button.dataset.tool;
                    let modalHTML = '';
                    switch(tool) {
                        case 'protocols':
                            modalHTML = `
                                <button class="close-modal-btn absolute top-4 left-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
                                <h3 class="text-2xl font-bold mb-4 text-center text-[--primary-color]">🧪 بروتوكولات طِبرا العلاجية</h3>
                                <p class="text-center text-gray-600 mb-6">بروتوكولات علاجية متكاملة صمّمها د. عمر لمرافقة رحلة الشفاء الطبيعية</p>
                                <div class="grid gap-4 sm:grid-cols-2">
                                    <div class="p-6 bg-white rounded-lg shadow border text-right flex flex-col justify-between">
                                        <div>
                                            <h4 class="font-bold text-lg mb-2">💆‍♂️ بروتوكول تقوية وتغذية الشعر وإزالة الشيب والصلع</h4>
                                            <p class="text-sm mb-4">بروتوكول شامل لتقوية الجذور، تأخير الشيب، وتحفيز نمو الشعر الطبيعي</p>
                                        </div>
                                        <button class="btn btn-secondary w-full mt-auto" onclick="openModal('hair-protocol-modal')">عرض التفاصيل</button>
                                    </div>
                                    <div class="p-6 bg-white rounded-lg shadow border text-right flex flex-col justify-between">
                                        <div>
                                            <h4 class="font-bold text-lg mb-2">🩺 بروتوكول البواسير المتكامل</h4>
                                            <p class="text-sm mb-4">علاج شامل للبواسير عبر الدمج بين الطب الحديث، الأعشاب، المكملات، والعلاج الطاقي–الشعوري. بإشراف د. عمر.</p>
                                        </div>
                                        <button class="btn btn-secondary w-full mt-auto" onclick="openModal('hemorrhoid-protocol-modal')">عرض التفاصيل</button>
                                    </div>
                                    <div class="p-6 bg-gray-50 rounded-lg shadow border flex items-center justify-center text-center">
                                        <h4 class="font-bold">🧠 بروتوكول صفاء الدماغ<br><span class="text-sm text-gray-500">قريبًا</span></h4>
                                    </div>
                                    <div class="p-6 bg-gray-50 rounded-lg shadow border flex items-center justify-center text-center">
                                        <h4 class="font-bold">🔥 بروتوكول تقليل الالتهاب<br><span class="text-sm text-gray-500">قريبًا</span></h4>
                                    </div>
                                    <div class="p-6 bg-gray-50 rounded-lg shadow border flex items-center justify-center text-center">
                                        <h4 class="font-bold">🌿 بروتوكول تنظيف القولون<br><span class="text-sm text-gray-500">قريبًا</span></h4>
                                    </div>
                                </div>`;
                            showModal(modalHTML);
                            break;
                        case 'hair-protocol':
                            modalHTML = `
                                <button class="close-modal-btn absolute top-4 left-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
                                <h3 class="text-2xl font-bold mb-4 text-center text-[--primary-color]">البروتوكول الشمولي لعلاج الشعر</h3>
                                <div class="text-right space-y-4">
                                    <p class="text-center text-gray-600 mb-4">بروتوكول علاجي شامل لتأخير الشيب وتحفيز تصبغ الشعر وتقليل التساقط.</p>
                                    
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 1: الزيوت العلاجية الموضعية (2-3 مرات أسبوعياً)</h4>
                                        <p><strong>التركيبة:</strong></p>
                                        <ul class="list-disc list-inside pr-4">
                                            <li>زيت إكليل الجبل: 10 مل</li>
                                            <li>زيت النعناع: 5 مل</li>
                                            <li>زيت الليمون: 5 مل</li>
                                            <li>زيت السمسم (كزيت حامل): 30 مل</li>
                                            <li>زيت الخروع (اختياري للتكثيف): 10 مل</li>
                                            <li>كيروسين طبي أو بارافين طبي: 5 مل</li>
                                        </ul>
                                        <p class="mt-2"><strong>طريقة الاستخدام:</strong> امزج المكونات، دفئها قليلاً، دلك فروة الرأس لـ 5-10 دقائق، واتركها لساعتين على الأقل قبل غسلها بشامبو طبيعي.</p>
                                    </div>

                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 2: مكملات غذائية يومية</h4>
                                         <ul class="list-disc list-inside pr-4">
                                            <li><strong>صباحًا بعد الفطور:</strong> Zinc (30-50 ملغ) مع Vitamin C (Liposomal) (500-1000 ملغ)</li>
                                            <li><strong>بعد ساعتين من الزنك:</strong> Copper (2-3 ملغ)</li>
                                            <li><strong>صباحًا أو مساءً:</strong> Fo-Ti (كبسولة 500-1000 ملغ) - <span class="text-red-500 font-bold">ينصح بعمل تحليل وظائف كبد.</span></li>
                                        </ul>
                                    </div>
                                    
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 3: قناع الشعر الطبيعي (مرة أسبوعياً)</h4>
                                        <p><strong>التركيبة:</strong> ملعقة كبيرة سدر بودرة، ملعقة صغيرة عكبر نحل، نصف ملعقة صغيرة بذور الخلة المطحونة، 2 ملعقة كبيرة خل تفاح طبيعي، وماء دافئ للعجن.</p>
                                        <p class="mt-2"><strong>طريقة الاستخدام:</strong> يوضع على الفروة والشعر لمدة 30-60 دقيقة ثم يغسل جيداً.</p>
                                    </div>

                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <h4 class="font-bold text-lg mb-2 text-[--primary-dark]">الجزء 4: مادة ORMUS</h4>
                                        <p><strong>الجرعة:</strong> ملعقة صغيرة يومياً صباحاً على معدة فارغة من مصدر موثوق.</p>
                                        <p><strong>الفوائد:</strong> يزيد التركيز، يوازن الطاقات، ويحفز تجدد الخلايا الصبغية.</p>
                                        <p class="text-red-500 font-bold mt-2">تحذير: لا تستخدم ORMUS مع أدوية نفسية أو مناعية دون استشارة طبيب.</p>
                                    </div>

                                    <div class="p-4 bg-green-50 rounded-lg border-r-4 border-green-500">
                                        <h4 class="font-bold text-lg mb-2 text-green-800">نصائح عامة داعمة</h4>
                                        <ul class="list-disc list-inside pr-4">
                                            <li>اتبع نظامًا غذائيًا غنيًا بفيتامينات B12، حمض الفوليك، والسيليكا.</li>
                                            <li>خفف التوتر، لأن الإجهاد يزيد من الشيب.</li>
                                            <li>تجنب الصبغات الكيميائية القوية أثناء البروتوكول.</li>
                                            <li>أكثر من شرب العصائر الخضراء.</li>
                                        </ul>
                                    </div>
                                </div>`;
                             break;
                         case 'blood-test-decoder':
                             modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">فك شفرة تحاليل الدم</h3>
                                 <p class="text-gray-600 mb-6">الصق نتائج تحاليل دمك هنا. ستقوم الأداة بتحليلها من منظور الطب الوظيفي، مع التركيز على المعدلات المثالية وليس فقط الطبيعية.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="blood-test-data" class="block text-right font-semibold mb-2">نتائج التحليل</label>
                                         <textarea id="blood-test-data" rows="10" class="w-full p-2 border rounded-md" placeholder="مثال:&#10;Vitamin D (25-OH) ..... 21 ng/mL&#10;Ferritin ................ 35 ng/mL&#10;TSH ..................... 3.8 mIU/L"></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">حلل نتائجي</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'diagnosis':
                             modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">تشخيص متعدد الأبعاد</h3>
                                 <p class="text-gray-600 mb-6">يرجى إدخال المعلومات التالية بأكبر قدر ممكن من التفصيل.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="symptoms" class="block text-right font-semibold mb-2">1. الأعراض الجسدية</label>
                                         <textarea id="symptoms" rows="3" class="w-full p-2 border rounded-md" placeholder="مثال: صداع نصفي، ألم في المفاصل..."></textarea>
                                     </div>
                                     <div class="mb-4">
                                         <label for="feelings" class="block text-right font-semibold mb-2">2. المشاعر والأفكار</label>
                                         <textarea id="feelings" rows="3" class="w-full p-2 border rounded-md" placeholder="مثال: أشعر بقلق دائم، أفكار سلبية..."></textarea>
                                     </div>
                                     <div class="mb-4">
                                         <label for="lifestyle" class="block text-right font-semibold mb-2">3. نمط الحياة</label>
                                         <textarea id="lifestyle" rows="3" class="w-full p-2 border rounded-md" placeholder="مثال: نومي متقطع، أعتمد على الوجبات السريعة..."></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">ابدأ التحليل</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'treatment-plan':
                             modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">وصفة علاجية شمولية ذكية</h3>
                                 <p class="text-gray-600 mb-6">أدخل التشخيص أو الأعراض الرئيسية، مع معلومات إضافية، للحصول على خطة علاجية مقترحة.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="diagnosis-input" class="block text-right font-semibold mb-2">1. التشخيص أو الأعراض الرئيسية</label>
                                         <textarea id="diagnosis-input" rows="4" class="w-full p-2 border rounded-md" placeholder="مثال: تشخيص بالقولون العصبي، مع قلق وتعب مستمر"></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">صمم خطتي</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'awareness-exercise':
                              modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">تمرين وعي موجّه</h3>
                                 <p class="text-gray-600 mb-6">صف المشاعر التي تمر بها أو الصدمة التي تود العمل عليها، وسيقوم المساعد الذكي بإنشاء تمرين كتابة موجه لك.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="repressed-feelings" class="block text-right font-semibold mb-2">المشاعر المكبوتة أو الصدمة</label>
                                         <textarea id="repressed-feelings" rows="4" class="w-full p-2 border rounded-md" placeholder="مثال: أشعر بغضب مكبوت تجاه موقف معين..."></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">أنشئ التمرين</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'consultation':
                              modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">استشارة طبية آلية</h3>
                                 <p class="text-gray-600 mb-6">اطرح سؤالك على مساعد د. عمر الذكي للحصول على إجابات تستند إلى مبادئ الطب الشمولي.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="question" class="block text-right font-semibold mb-2">سؤالك</label>
                                         <textarea id="question" rows="4" class="w-full p-2 border rounded-md" placeholder="مثال: ما هي أفضل الطرق لتقوية المناعة بشكل طبيعي؟"></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">احصل على الإجابة</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'supplements':
                              modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">توصية مكملات غذائية</h3>
                                 <p class="text-gray-600 mb-6">صف أعراضك أو الصق نتائج تحليل الدم هنا، وسيقوم المساعد الذكي بتحليلها وتقديم توصيات للمكملات الغذائية.</p>
                                 <form id="tool-form">
                                     <div class="mb-4">
                                         <label for="analysis-data" class="block text-right font-semibold mb-2">الأعراض أو نتائج التحليل</label>
                                         <textarea id="analysis-data" rows="5" class="w-full p-2 border rounded-md" placeholder="مثال: أعاني من تساقط الشعر، إرهاق مستمر..."></textarea>
                                     </div>
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">احصل على توصية</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                         case 'intention':
                              modalHTML = `
                                 <h3 class="text-2xl font-bold mb-4 text-[--primary-color]">نية اليوم</h3>
                                 <p class="text-gray-600 mb-6">احصل على نية إيجابية ومركزة لدعمك في يومك.</p>
                                 <form id="tool-form">
                                     <div class="text-left">
                                         <button type="button" class="close-modal-btn btn btn-secondary py-2 px-6 rounded-full">إغلاق</button>
                                         <button type="submit" class="btn btn-primary text-white py-2 px-6 rounded-full mr-2">أعطني نيتي</button>
                                     </div>
                                 </form>
                                 <div id="tool-results" class="mt-6 hidden"></div>`;
                             break;
                    }
                    showModal(modalHTML);
                    const form = document.getElementById('tool-form');
                    if (form) form.addEventListener('submit', (e) => handleToolSubmit(e, tool));
                });
            });
            
            async function handleToolSubmit(e, tool) {
                e.preventDefault();
                let prompt = '', toolTitle = '', rawInputForSaving = '';
                 switch(tool) {
                       case 'blood-test-decoder':
                           toolTitle = "فك شفرة تحاليل الدم";
                           const bloodTestData = document.getElementById('blood-test-data').value;
                           rawInputForSaving = `بيانات التحليل: ${bloodTestData}`;
                           if (!bloodTestData) { showNotification('يرجى لصق نتائج التحليل.', 'warning'); return; }
                           prompt = `Act as a functional medicine expert analyzing blood test results. The user has provided these results: "${bloodTestData}". Your task is to:
1.  Identify key markers (like Vitamin D, Ferritin, TSH, etc.).
2.  For each marker, state its functional/optimal range (which is often stricter than the standard lab range).
3.  Compare the user's result to the optimal range.
4.  Explain in simple Arabic what this result means for their health from a holistic perspective (e.g., how low ferritin affects energy and hair).
5.  Provide actionable recommendations including specific foods, lifestyle changes, and potential supplements to help them reach the optimal range.
Structure the output in Arabic with clear headings for each marker using markdown. Start with a disclaimer that this is not a medical diagnosis.`;
                           break;
                       case 'diagnosis':
                           toolTitle = "تشخيص متعدد الأبعاد";
                           const symptoms = document.getElementById('symptoms').value;
                           const feelings = document.getElementById('feelings').value;
                           const lifestyle = document.getElementById('lifestyle').value;
                           rawInputForSaving = `الأعراض: ${symptoms}\nالمشاعر: ${feelings}\nنمط الحياة: ${lifestyle}`;
                           if (!symptoms && !feelings && !lifestyle) { showNotification('يرجى إدخال بعض المعلومات للتحليل.', 'warning'); return; }
                           prompt = `Act as a holistic medicine expert. Analyze the user's input based on a tripartite model (organic, emotional, energetic) and provide a probable diagnosis or assessment. User Input -> Symptoms: "${symptoms}", Feelings: "${feelings}", Lifestyle: "${lifestyle}". Structure the output as a clean, readable text in Arabic with three main sections: "الاحتمال العضوي", "الجذر الشعوري", and "التوازن الطاقي المختل". Use markdown for formatting.`;
                           break;
                       case 'treatment-plan':
                           toolTitle = "وصفة علاجية شمولية";
                           const diagnosisInput = document.getElementById('diagnosis-input').value;
                           rawInputForSaving = `التشخيص: ${diagnosisInput}`;
                           if (!diagnosisInput) { showNotification('يرجى إدخال التشخيص أو الأعراض الرئيسية.', 'warning'); return; }
                           prompt = `As a functional medicine doctor, design a comprehensive 21-day holistic treatment plan for a patient with the following diagnosis/symptoms: "${diagnosisInput}". The plan should include sections for: "الأدوية أو المكملات المقترحة", "توصيات التغذية", "تمارين تأمل أو وعي", and "نصائح طاقة ونمط حياة". Present the output in a well-structured, easy-to-read format in Arabic using markdown.`;
                           break;
                       case 'awareness-exercise':
                           toolTitle = "تمرين وعي موجّه";
                           const repressedFeelings = document.getElementById('repressed-feelings').value;
                           rawInputForSaving = `المشاعر: ${repressedFeelings}`;
                           if (!repressedFeelings) { showNotification('يرجى وصف مشاعرك.', 'warning'); return; }
                           prompt = `You are a therapeutic writing coach. Based on the user's stated repressed feelings: "${repressedFeelings}", create a guided expressive writing exercise. The output should be in Arabic and include: 1. A gentle introduction. 2. A series of 3-5 reflective writing prompts. 3. A concluding guidance on how to process what they've written. Format the output with clear headings using markdown.`;
                           break;
                       case 'consultation':
                           toolTitle = "استشارة طبية آلية";
                           const question = document.getElementById('question').value;
                           rawInputForSaving = `السؤال: ${question}`;
                           if (!question) { showNotification('يرجى كتابة سؤالك.', 'warning'); return; }
                           prompt = `As a holistic medicine assistant for Dr. Omar, answer the following question in Arabic, incorporating principles of holistic, functional, and spiritual medicine where appropriate. Question: "${question}"`;
                           break;
                       case 'supplements':
                           toolTitle = "توصية مكملات غذائية";
                           const analysisData = document.getElementById('analysis-data').value;
                           rawInputForSaving = `البيانات: ${analysisData}`;
                           if (!analysisData) { showNotification('يرجى إدخال الأعراض أو نتائج التحليل.', 'warning'); return; }
                           prompt = `As a functional medicine expert, analyze the provided symptoms or blood test results: "${analysisData}" and recommend the most effective supplements. Include recommended timing (e.g., with food, in the morning) and any potential warnings. The output should be a clear, bulleted list in Arabic.`;
                           break;
                       case 'intention':
                           toolTitle = "نية اليوم";
                           rawInputForSaving = `طلب نية اليوم`;
                           prompt = `As a spiritual wellness coach, provide a supportive, healing daily intention for the user. The output should be a single, powerful intention sentence in Arabic, followed by a short (1-2 sentences) "تمرين دعم داخلي" to help them embody that intention.`;
                           break;
                }
                const responseText = await handleApiRequest(prompt, 'tool-results', GEMINI_API_KEY);
                if (responseText) {
                    const resultsDiv = document.getElementById('tool-results');
                    resultsDiv.innerHTML = `
                        <div id="result-content" class="p-4 bg-gray-50 rounded-md text-right whitespace-pre-wrap border">${responseText}</div>
                        <div class="mt-4 text-left">
                            ${currentUser ? '<button id="save-result-btn" class="btn btn-secondary py-2 px-4 rounded-full text-sm">حفظ النتيجة</button>' : ''}
                            <button id="download-pdf-btn" class="btn btn-primary text-white py-2 px-4 rounded-full mr-2 text-sm">تحميل كـ PDF</button>
                        </div>`;
                    if (currentUser) {
                        document.getElementById('save-result-btn').addEventListener('click', () => {
                            const fullResultText = `--- المدخلات ---\n${rawInputForSaving}\n\n--- نتيجة التحليل ---\n${responseText}`;
                            saveResultToFirestore(toolTitle, fullResultText)
                        });
                    }
                    document.getElementById('download-pdf-btn').addEventListener('click', () => downloadResultAsPDF('result-content', toolTitle));
                }
            }
        }
        
        // --- PDF DOWNLOAD MODULE ---
        function downloadResultAsPDF(elementId, title) {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById(elementId);
            if (!element) return;
            showNotification("جاري إعداد ملف الـ PDF...", 'warning', 2000);
            html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                pdf.setProperties({ title: `تقرير ${title} - د. عمر العماد`, author: 'موقع د. عمر العماد - TibraSoul' });
                const pdfWidth = pdf.internal.pageSize.getWidth();
                pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth - 20, 0);
                pdf.save(`${title.replace(/\s+/g, '-')}_${new Date().toISOString().split('T')[0]}.pdf`);
            });
        }

        // --- FREQUENCY GENERATOR MODULE (ROBUST & UPGRADED) ---
        function initFrequencyGenerator() {
            const audioPrompt = document.getElementById('audio-init-prompt');
            const startAudioBtn = document.getElementById('start-audio-btn');
            const playerContainer = document.getElementById('frequency-player-container');
            const stopFreqBtn = document.getElementById('stop-freq-btn');
            const canvas = document.getElementById('frequency-canvas');
            const musicPlayer = document.getElementById('background-music');
            const musicPlayPauseBtn = document.getElementById('music-play-pause-btn');
            const musicVolumeSlider = document.getElementById('music-volume');

            if (!startAudioBtn || !playerContainer) return;

            let audioContext, oscillator, analyser, gainNode, animationFrameId;
            let isAudioInitialized = false;
            const canvasCtx = canvas.getContext('2d');
            
            const allFreqButtons = document.querySelectorAll('.freq-btn');

            const setupAudioSystem = async () => {
                if (isAudioInitialized) return true;
                try {
                    await Tone.start();
                    audioContext = Tone.context;
                    analyser = new Tone.Analyser('waveform', 1024);
                    gainNode = new Tone.Gain(0.5).toDestination();
                    isAudioInitialized = true;
                    console.log("Audio Context is ready.");
                    audioPrompt.classList.add('hidden');
                    playerContainer.classList.remove('hidden');
                    return true;
                } catch (e) {
                    console.error("Could not start Audio Context: ", e);
                    showNotification("لا يمكن تشغيل الصوت. يرجى التفاعل مع الصفحة أولاً.", "error");
                    return false;
                }
            };
            
            startAudioBtn.addEventListener('click', setupAudioSystem);

            const playFrequency = (freq) => {
                if (!isAudioInitialized) return;
                
                musicPlayer.pause();
                musicPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';

                if (oscillator) {
                    oscillator.disconnect();
                    oscillator.stop();
                }

                oscillator = new Tone.Oscillator(freq, "sine").connect(analyser).connect(gainNode);
                oscillator.volume.value = -9;
                oscillator.start();
                
                stopFreqBtn.classList.remove('hidden');
                if (!animationFrameId) visualize();
            };
            
            const stopFrequency = () => {
                if (oscillator) {
                    oscillator.stop();
                    oscillator.disconnect();
                    oscillator = null;
                }
                stopFreqBtn.classList.add('hidden');
                allFreqButtons.forEach(b => b.classList.remove('active'));
            };
            
            function visualize() {
                const draw = () => {
                    animationFrameId = requestAnimationFrame(draw);
                    if (!analyser || !oscillator) {
                       canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
                       return;
                    };
                    const waveform = analyser.getValue();
                    canvasCtx.fillStyle = '#121212';
                    canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
                    canvasCtx.lineWidth = 2;
                    canvasCtx.strokeStyle = 'rgb(200, 160, 125, 0.7)';
                    canvasCtx.beginPath();
                    
                    for (let i = 0; i < waveform.length; i++) {
                        const x = (i / (waveform.length -1)) * canvas.width;
                        const y = (waveform[i] + 1) / 2 * canvas.height;
                        if (i === 0) canvasCtx.moveTo(x, y);
                        else canvasCtx.lineTo(x, y);
                    }
                    canvasCtx.stroke();
                };
                draw();
            }
            
            allFreqButtons.forEach(button => {
                 button.addEventListener('click', async (e) => {
                    if (!isAudioInitialized) {
                       const audioReady = await setupAudioSystem();
                       if (!audioReady) return;
                    }
                    allFreqButtons.forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    const freq = parseFloat(button.dataset.freq);
                    playFrequency(freq);
                });
            });
            
            stopFreqBtn.addEventListener('click', stopFrequency);
            
            // Music Player Logic
            musicPlayPauseBtn.addEventListener('click', () => {
                if (!isAudioInitialized) return;
                if (musicPlayer.paused) {
                    stopFrequency();
                    musicPlayer.play();
                    musicPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    musicPlayer.pause();
                    musicPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
            });
            musicVolumeSlider.addEventListener('input', (e) => {
                musicPlayer.volume = e.target.value;
            });
        }

        // --- BLOG MODULE ---
        function initBlog() {
            const posts = {
                'gut-brain': { 
                    title: 'هل أمعاؤك هي سبب تقلبات مزاجك؟', 
                    image: 'https://images.unsplash.com/photo-1498837167922-ddd27525d352?q=80&w=2070&auto=format&fit=crop', 
                    content: `
                        <h2>العلاقة الخفية بين القناة الهضمية والدماغ</h2>
                        <p>هل تعلم أن أمعاءك يطلق عليها "الدماغ الثاني"؟ هذا ليس مجرد تعبير مجازي. يوجد اتصال مباشر ومعقد بين دماغك وجهازك الهضمي، يُعرف باسم محور الأمعاء-الدماغ. هذا المحور هو طريق سريع ثنائي الاتجاه، حيث ترسل الأمعاء إشارات إلى الدماغ والعكس صحيح.</p>
                        <p>ما يقرب من 80-90% من السيروتونين في الجسم، وهو ناقل عصبي رئيسي مسؤول عن الشعور بالسعادة والرفاهية، يتم إنتاجه في القناة الهضمية. عندما يكون الميكروبيوم المعوي (مجموعة البكتيريا والكائنات الحية الدقيقة الأخرى في أمعائك) غير متوازن، يمكن أن يؤثر ذلك بشكل مباشر على إنتاج السيروتونين، مما يؤدي إلى تقلبات مزاجية، قلق، وحتى اكتئاب.</p>
                        <h2>كيف تدعم هذا المحور الهام؟</h2>
                        <ul>
                            <li><strong>تغذية غنية بالألياف:</strong> تغذي الألياف البكتيريا المفيدة في أمعائك. ركز على الخضروات والفواكه والبقوليات.</li>
                            <li><strong>الأطعمة المخمرة:</strong> الزبادي، الكفير، مخلل الملفوف هي مصادر ممتازة للبروبيوتيك (البكتيريا الجيدة).</li>
                            <li><strong>تقليل السكر والأطعمة المصنعة:</strong> هذه الأطعمة تغذي البكتيريا الضارة وتسبب الالتهابات.</li>
                            <li><strong>إدارة الإجهاد:</strong> الإجهاد المزمن يمكن أن يضر ببطانة الأمعاء ويخل بتوازن الميكروبيوم. مارس التأمل، التنفس العميق، أو اليوجا.</li>
                        </ul>
                        <p>الاهتمام بصحة أمعائك ليس فقط لتحسين الهضم، بل هو خطوة أساسية نحو صحة نفسية وعقلية أفضل. ابدأ اليوم بإجراء تغيير صغير واحد، وشاهد كيف يتغير شعورك.</p>
                    ` 
                },
                'breathing': { 
                    title: 'قوة التنفس: كيف تهدئ جهازك العصبي في 5 دقائق', 
                    image: 'https://images.unsplash.com/photo-1599301934984-1d2741913a5f?q=80&w=2070&auto=format&fit=crop', 
                    content: `
                        <h2>أقوى أداة للتحكم في حالتك النفسية</h2>
                        <p>أنفاسك هي الأداة الأكثر فعالية ومجانية التي تمتلكها لتغيير حالتك الفسيولوجية والنفسية بشكل فوري. عندما تشعر بالتوتر أو القلق، يتنشط جهازك العصبي الودي (استجابة "الكر أو الفر")، مما يؤدي إلى تسارع ضربات القلب والتنفس السطحي. التنفس العميق والبطيء يفعل العكس تمامًا: إنه ينشط جهازك العصبي اللاودي (استجابة "الراحة والهضم").</p>
                        <h2>تمرين التنفس الصندوقي (Box Breathing)</h2>
                        <p>هذه التقنية بسيطة جدًا وفعالة، ويستخدمها حتى أفراد القوات الخاصة لتهدئة أنفسهم تحت الضغط. اتبع هذه الخطوات:</p>
                        <ul>
                            <li><strong>شهيق:</strong> خذ شهيقًا عميقًا من أنفك ببطء وعد حتى 4.</li>
                            <li><strong>احبس:</strong> احبس أنفاسك وعد حتى 4.</li>
                            <li><strong>زفير:</strong> أخرج الهواء ببطء من فمك وعد حتى 4.</li>
                            <li><strong>احبس:</strong> احبس أنفاسك مرة أخرى وعد حتى 4.</li>
                        </ul>
                        <p>كرر هذه الدورة لمدة 3-5 دقائق. يمكنك ممارسة هذا التمرين في أي مكان وفي أي وقت تشعر فيه بالحاجة إلى الهدوء والتركيز. ستلاحظ فرقًا فوريًا في شعورك بالسكينة والوضوح الذهني.</p>
                    `
                },
                'supplements': { 
                    title: 'أفضل 3 مكملات غذائية لمكافحة الالتهابات', 
                    image: 'https://images.unsplash.com/photo-1476837579993-f1d3948f17c2?q=80&w=2070&auto=format&fit=crop', 
                    content: `
                        <h2>الالتهاب: صديق وعدو</h2>
                        <p>الالتهاب هو استجابة طبيعية من الجسم للشفاء من الإصابات والعدوى. ولكن عندما يصبح الالتهاب مزمنًا، فإنه يساهم في مجموعة واسعة من الأمراض، من أمراض القلب والسكري إلى أمراض المناعة الذاتية. بجانب النظام الغذائي الصحي، يمكن لبعض المكملات أن تساعد في السيطرة على الالتهاب المزمن.</p>
                        <h2>أفضل توصياتي</h2>
                        <ul>
                            <li><strong>الكركمين (المادة الفعالة في الكركم):</strong> يعتبر الكركمين من أقوى مضادات الالتهاب الطبيعية. إنه يعمل على مسارات متعددة في الجسم لتقليل الالتهاب. ابحث عن مكمل يحتوي على الفلفل الأسود (بيبرين) لزيادة الامتصاص بشكل كبير.</li>
                            <li><strong>أحماض أوميغا-3 الدهنية:</strong> توجد في زيت السمك وزيت الكريل، وهي ضرورية لخفض الالتهاب في الجسم. إنها تساعد في موازنة نسبة أوميغا-6 إلى أوميغا-3، والتي غالبًا ما تكون مختلة في النظم الغذائية الحديثة.</li>
                            <li><strong>المغنيسيوم:</strong> هذا المعدن الأساسي يشارك في أكثر من 300 تفاعل كيميائي حيوي في الجسم، بما في ذلك تنظيم استجابة الجسم للالتهابات. نقص المغنيسيوم شائع جدًا ويمكن أن يؤدي إلى زيادة الالتهاب المزمن.</li>
                        </ul>
                        <p><strong>ملاحظة هامة:</strong> استشر دائمًا أخصائي رعاية صحية قبل البدء في أي نظام مكملات جديد، خاصة إذا كنت تتناول أدوية أخرى أو لديك حالة طبية موجودة.</p>
                    ` 
                }
            };
            document.querySelectorAll('.read-more-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const postId = button.dataset.postid;
                    const post = posts[postId];
                    if (post) {
                        document.getElementById('post-title').textContent = post.title;
                        document.getElementById('post-image').src = post.image;
                        document.getElementById('post-image').alt = post.title;
                        document.getElementById('post-content').innerHTML = post.content;
                        showView('single-post');
                    }
                });
            });
        }

        // --- WHEEL OF LIFE MODULE ---
        function initWheelOfLife() {
            const ctx = document.getElementById('wheel-of-life-chart');
            if (!ctx) return;
            const slidersContainer = document.getElementById('wheel-of-life-sliders');
            const getInsightBtn = document.getElementById('get-wheel-insight-btn');
            
            const labels = ['الصحة الجسدية', 'النمو الشخصي', 'الحياة المهنية', 'المالية', 'البيئة المحيطة', 'المرح والاستجمام', 'العلاقات الأسرية والاجتماعية', 'الحياة الروحية'];
            const initialData = Array(labels.length).fill(5);
            
            slidersContainer.innerHTML = labels.map((label, index) => `
                <div class="flex items-center gap-4">
                    <label for="slider-${index}" class="w-1/3 text-right">${label}</label>
                    <input type="range" id="slider-${index}" min="0" max="10" value="5" class="range-slider flex-grow" data-index="${index}">
                    <span id="value-${index}" class="w-8 text-center font-bold">5</span>
                </div>`).join('');
            
            wheelChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'تقييمي الحالي',
                        data: initialData,
                        fill: true,
                        backgroundColor: 'rgba(200, 160, 125, 0.4)',
                        borderColor: 'rgb(200, 160, 125)',
                        pointBackgroundColor: 'rgb(200, 160, 125)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(200, 160, 125)'
                    }]
                },
                options: {
                    elements: { line: { borderWidth: 3 } },
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(90, 110, 90, 0.3)' },
                            grid: { color: 'rgba(90, 110, 90, 0.3)' },
                            pointLabels: { font: { family: "'Noto Kufi Arabic', sans-serif", size: 13 }, color: '#333' },
                            ticks: { backdropColor: 'var(--secondary-color)', color: '#555', stepSize: 2 },
                            suggestedMin: 0,
                            suggestedMax: 10
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            slidersContainer.addEventListener('input', (e) => {
                if (e.target.type === 'range') {
                    const index = e.target.dataset.index;
                    const value = e.target.value;
                    document.getElementById(`value-${index}`).textContent = value;
                    wheelChart.data.datasets[0].data[index] = value;
                    wheelChart.update();
                }
            });
            
            getInsightBtn.addEventListener('click', getWheelInsight);
        }
        
        async function getWheelInsight() {
            const resultDiv = document.getElementById('wheel-of-life-result');
            const data = wheelChart.data.datasets[0].data;
            const labels = wheelChart.data.labels;
            
            resultDiv.classList.remove('hidden');
            resultDiv.style.opacity = '0';
            
            let userInput = "User's Wheel of Life scores are: ";
            labels.forEach((label, index) => {
                userInput += `${label}: ${data[index]}/10, `;
            });

            const prompt = `Act as a wise and compassionate holistic life coach. Based on the user's Wheel of Life scores: [${userInput}]. Your task is to:
1.  Identify the top 2-3 highest scoring areas and acknowledge them as strengths.
2.  Identify the top 2-3 lowest scoring areas and frame them as opportunities for growth, not failures.
3.  Provide one insightful, holistic observation about the potential interplay between the high and low areas (e.g., "I notice your career score is high, but your health is low. Perhaps your professional success is coming at the expense of your physical wellbeing?").
4.  Offer one simple, actionable first step for one of the lowest areas.
5.  End with an encouraging and empowering message.
The entire response should be in warm, supportive Arabic. Start with a positive affirmation. Use markdown for lists and bolding.`;
            
            const insightText = await handleApiRequest(prompt, 'wheel-of-life-result', GEMINI_API_KEY);

            if (insightText) {
                resultDiv.innerHTML = `
                    <div id="wheel-result-content" class="text-right whitespace-pre-wrap">${insightText}</div>
                    <div class="mt-4 text-center">
                        ${currentUser ? '<button id="save-wheel-result-btn" class="btn btn-secondary py-2 px-4 rounded-full text-sm">حفظ النتيجة في ملفي</button>' : '<p class="text-sm text-gray-500">سجل الدخول لحفظ هذه الرؤى القيمة!</p>'}
                    </div>`;
                if(currentUser) {
                    document.getElementById('save-wheel-result-btn').addEventListener('click', () => {
                        const fullResultText = `--- تقييم عجلة العافية ---\n${userInput}\n\n--- رؤى التحليل ---\n${insightText}`;
                        saveResultToFirestore("تحليل عجلة العافية", fullResultText);
                    });
                }
            }
            resultDiv.style.opacity = '1';
        }
        
        // --- AUDIO PLAYER MODULE ---
        function initAudioPlayer() {
             const audio = document.getElementById('guided-audio');
            if(!audio) return;
            const playPauseBtn = document.getElementById('audio-play-pause-btn');
            const playIcon = playPauseBtn.querySelector('i');
            const progressBar = document.getElementById('audio-progress-bar');
            const timeDisplay = document.getElementById('audio-time');
            const totalDuration = 60; // 1 minute

            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            };

            playPauseBtn.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    playIcon.classList.replace('fa-play-circle', 'fa-pause-circle');
                } else {
                    audio.pause();
                    playIcon.classList.replace('fa-pause-circle', 'fa-play-circle');
                }
            });

            audio.addEventListener('timeupdate', () => {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.value = progress;
                timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(totalDuration)}`;
            });

            audio.addEventListener('ended', () => {
                playIcon.classList.replace('fa-pause-circle', 'fa-play-circle');
                progressBar.value = 0;
                timeDisplay.textContent = `00:00 / ${formatTime(totalDuration)}`;
            });

            progressBar.addEventListener('input', () => {
                const seekTime = (progressBar.value / 100) * audio.duration;
                audio.currentTime = seekTime;
            });
        }

        // --- GENERAL UI & CREATIVE EFFECTS ---
        function initGeneralUI() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            mobileMenu.addEventListener('click', (e) => { 
                if(e.target.classList.contains('nav-link') || e.target.closest('.nav-link')){
                     mobileMenu.classList.add('hidden');
                }
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('is-visible');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));
            
            // Back to top button
            const backToTopBtn = document.getElementById('back-to-top-btn');
            window.addEventListener('scroll', () => {
                backToTopBtn.classList.toggle('hidden', window.scrollY < 300);
            }, { passive: true });
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        function initCreativeEffects() {
            const cards = document.querySelectorAll('.dashboard-card');
            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const rotateX = ((y - card.offsetHeight / 2) / (card.offsetHeight / 2)) * -5;
                    const rotateY = ((x - card.offsetWidth / 2) / (card.offsetWidth / 2)) * 5;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
                });
            });
            document.querySelectorAll('.btn').forEach(button => {
                button.addEventListener('click', function(e) {
                     const rect = this.getBoundingClientRect();
                     const ripple = document.createElement('span');
                     const d = Math.max(this.clientWidth, this.clientHeight);
                     ripple.style.width = ripple.style.height = d + 'px';
                     ripple.style.left = e.clientX - rect.left - d/2 + 'px';
                     ripple.style.top = e.clientY - rect.top - d/2 + 'px';
                     ripple.classList.add('ripple');
                     this.appendChild(ripple);
                     setTimeout(() => ripple.remove(), 600);
                });
            });
        }

        // --- BODY MAP MODULE (SVG UPGRADE) ---
        function initBodyMap() {
            const infoContainer = document.getElementById('body-map-info');
            const organNameEl = document.getElementById('organ-name');
            const organDetailsEl = document.getElementById('organ-details');
            const organPaths = document.querySelectorAll('#body-map-svg .organ-path');
            if (!infoContainer) return;
            
            window.organData = {
                brain: {
                    name: 'الدماغ والجهاز العصبي',
                    emotionalCause: 'صراعات فكرية مستمرة، رفض أو مقاومة الأفكار الجديدة، الشعور بالانفصال عن الحدس الداخلي.',
                    associatedDiseases: 'الصداع النصفي، الزهايمر، باركنسون، الجلطات، الأورام، ضبابية الدماغ.',
                    holisticAdvice: 'مارس التأمل لتصفية الذهن، تعلم تقنيات التنفس لتهدئة الجهاز العصبي، اكتب أفكارك لتحريرها، ثق بحدسك أكثر.'
                },
                thyroid: {
                    name: 'الغدة الدرقية',
                    emotionalCause: 'الشعور بالإذلال، عدم القدرة على التعبير عن الذات، الشعور بأن دورك لم يأت بعد، كبت الإبداع.',
                    associatedDiseases: 'خمول أو فرط نشاط الغدة، تضخم الغدة، مرض هاشيموتو، مرض جريفز.',
                    holisticAdvice: 'تحدث عن حقيقتك، مارس هواية إبداعية (رسم، كتابة، غناء)، قل "لا" عند الحاجة، حرر رقبتك وكتفيك من خلال التمارين.'
                },
                heart: {
                    name: 'القلب',
                    emotionalCause: 'نقص الفرح والحب، جروح عاطفية قديمة، الشعور بالوحدة، النقد الذاتي القاسي.',
                    associatedDiseases: 'ارتفاع ضغط الدم، النوبات القلبية، عدم انتظام ضربات القلب, أمراض الشرايين.',
                    holisticAdvice: 'مارس الامتنان يومياً، سامح نفسك والآخرين، اقض وقتاً في الطبيعة، تواصل مع الأصدقاء والأحباء، احتضن أكثر.'
                },
                liver: {
                    name: 'الكبد',
                    emotionalCause: 'الغضب المكبوت، المرارة، الاستياء المزمن، الخوف من النقص والفقر.',
                    associatedDiseases: 'تليف الكبد، الكبد الدهني، التهاب الكبد، حصوات المرارة، مشاكل جلدية.',
                    holisticAdvice: 'تعلم تقنيات صحية للتعبير عن الغضب (مثل الكتابة أو الرياضة)، مارس التسامح، ركز على الوفرة بدلاً من النقص، تناول الأطعمة المرة (جرجير، هندباء).'
                },
                gut: {
                    name: 'الأمعاء (الجهاز الهضمي)',
                    emotionalCause: 'عدم القدرة على "هضم" أو تقبل مواقف الحياة، التمسك بالماضي، القلق المفرط بشأن المستقبل.',
                    associatedDiseases: 'القولون العصبي، كرونز، التهاب القولون التقرحي، الإمساك/الإسهال المزمن، الحساسيات الغذائية.',
                    holisticAdvice: 'مارس اليقظة الذهنية أثناء تناول الطعام، تعلم التخلي عما لا يمكنك التحكم فيه، اكتب مخاوفك على ورق، تناول البروبيوتيك لدعم "عقلك الثاني".'
                },
                adrenals: {
                    name: 'الغدد الكظرية',
                    emotionalCause: 'الإجهاد المزمن، الشعور بأنك في وضع "النجاة" باستمرار، عدم الشعور بالأمان، تحمل مسؤوليات تفوق طاقتك.',
                    associatedDiseases: 'الإرهاق الكظري، متلازمة التعب المزمن، مشاكل النوم، القلق.',
                    holisticAdvice: 'ضع حدوداً صحية، تعلم قول "لا"، خصص وقتاً يومياً للاسترخاء التام (بدون شاشات)، قلل من الكافيين، مارس التأمل أو اليوجا التصالحية.'
                },
                kidneys: {
                    name: 'الكلى',
                    emotionalCause: 'الخوف العميق، مشاكل في العلاقات والشراكات، الشعور بخيبة الأمل والنقد.',
                    associatedDiseases: 'حصوات الكلى، الفشل الكلوي، التهابات المسالك البولية المتكررة.',
                    holisticAdvice: 'واجه مخاوفك بدلاً من الهروب منها، قيم علاقاتك وابنِ روابط صحية، اشرب كمية كافية من الماء بنية التطهير، مارس تقنيات التأريض.'
                }
            };
            
            organPaths.forEach(path => {
                path.addEventListener('click', () => {
                    const organKey = path.dataset.organ;
                    const data = window.organData[organKey];

                    organPaths.forEach(p => p.classList.remove('selected'));
                    path.classList.add('selected');

                    if (data) {
                        infoContainer.style.opacity = 0;
                        infoContainer.style.transform = 'translateY(20px)';
                        
                        setTimeout(() => {
                            organNameEl.textContent = data.name;
                            organDetailsEl.innerHTML = `
                                <p class="mb-2"><strong>الأمراض المرتبطة:</strong> ${data.associatedDiseases}</p>
                                <p class="mb-2"><strong>السبب الشعوري الجذري:</strong> ${data.emotionalCause}</p>
                                <p class="mb-2"><strong>نصيحة شمولية:</strong> ${data.holisticAdvice}</p>
                            `;
                            infoContainer.style.opacity = 1;
                            infoContainer.style.transform = 'translateY(0)';
                        }, 300);
                    }
                });
            });
        }

        // --- QUIZZES MODULE (COMPLETED) ---
        function initQuizzes() {
            const modal = document.getElementById('quiz-modal');
            const modalContent = document.getElementById('quiz-modal-content');

            const quizzes = {
                'adrenal-fatigue': {
                    title: 'اختبار الإرهاق الكظري',
                    questions: [
                        { q: "هل تشعر بالتعب حتى بعد ليلة نوم كاملة؟", points: 2 },
                        { q: "هل تجد صعوبة في الاستيقاظ في الصباح؟", points: 2 },
                        { q: "هل تشتهي الأطعمة المالحة أو السكرية بشدة؟", points: 2 },
                        { q: "هل تشعر بالدوار أو الدوخة عند الوقوف بسرعة؟", points: 1 },
                        { q: "هل قدرتك على التعامل مع الإجهاد منخفضة؟", points: 2 },
                        { q: "هل تمرض بسهولة وتستغرق وقتاً أطول للشفاء؟", points: 1 },
                        { q: "هل تشعر بأن لديك طاقة أفضل في المساء؟", points: 1 },
                    ],
                    results: [
                        { score: 0, text: "احتمالية منخفضة لوجود إرهاق كظري. يبدو أن غددك الكظرية تعمل بشكل جيد. حافظ على نمط حياتك الصحي!" },
                        { score: 4, text: "احتمالية متوسطة لوجود إرهاق كظري. قد تكون غددك الكظرية تحت ضغط. من الجيد البدء في تطبيق تقنيات إدارة الإجهاد والنوم بشكل أفضل." },
                        { score: 7, text: "احتمالية عالية لوجود إرهاق كظري. غددك الكظرية بحاجة ماسة للدعم. نوصي بشدة بالتركيز على إدارة الإجهاد، التغذية الداعمة، والنوم. قد يكون من المفيد حجز استشارة لمناقشة النتائج." }
                    ]
                },
                'leaky-gut': {
                    title: 'تقييم الأمعاء المتسربة',
                    questions: [
                        { q: "هل تعاني من انتفاخ أو غازات أو آلام في البطن بشكل منتظم؟", points: 2 },
                        { q: "هل لديك حساسيات غذائية معروفة أو تشتبه في وجودها؟", points: 2 },
                        { q: "هل تعاني من مشاكل جلدية مثل الأكزيما، حب الشباب، أو الصدفية؟", points: 2 },
                        { q: "هل تعاني من آلام في المفاصل أو العضلات بدون سبب واضح؟", points: 1 },
                        { q: "هل تعاني من ضبابية الدماغ، صعوبة في التركيز، أو تقلبات مزاجية؟", points: 2 },
                        { q: "هل تم تشخيصك بمرض مناعي ذاتي (مثل الهاشيموتو أو التهاب المفاصل الروماتويدي)؟", points: 2 },
                        { q: "هل تتناول المضادات الحيوية أو مسكنات الألم بشكل متكرر؟", points: 1 },
                    ],
                    results: [
                        { score: 0, text: "احتمالية منخفضة لوجود أمعاء متسربة. جهازك الهضمي يبدو في حالة جيدة." },
                        { score: 4, text: "احتمالية متوسطة لوجود أمعاء متسربة. قد يكون من المفيد التركيز على نظام غذائي مضاد للالتهابات ودعم صحة الأمعاء." },
                        { score: 7, text: "احتمالية عالية لوجود أمعاء متسربة. نوصي بشدة بالنظر في بروتوكول علاجي للأمعاء واستشارة مختص." }
                    ]
                },
                'toxicity-score': {
                    title: 'احسب درجة السمية في جسمك',
                    questions: [
                        { q: "هل تستخدم أواني طهي غير لاصقة (تيفلون) بانتظام؟", points: 1 },
                        { q: "هل تشرب من قوارير بلاستيكية أو تستخدم حاويات طعام بلاستيكية؟", points: 1 },
                        { q: "هل نظامك الغذائي يحتوي على الكثير من الأطعمة المصنعة أو السريعة؟", points: 2 },
                        { q: "هل تستخدم منتجات التنظيف أو العناية الشخصية التقليدية (غير الطبيعية)؟", points: 2 },
                        { q: "هل تعاني من صداع، تعب، أو حساسية كيميائية (للعطور مثلاً)؟", points: 2 },
                        { q: "هل حركة أمعائك منتظمة (على الأقل مرة واحدة يومياً)؟", points: -2 }, 
                        { q: "هل تتعرق بانتظام من خلال التمارين الرياضية أو الساونا؟", points: -1 },
                    ],
                    results: [
                        { score: -3, text: "درجة سمية منخفضة جدًا. يبدو أنك تقوم بعمل رائع في تقليل تعرضك للسموم ودعم قدرة جسمك على التخلص منها." },
                        { score: 0, text: "درجة سمية منخفضة إلى معتدلة. هناك بعض الجوانب التي يمكن تحسينها لتقليل العبء على جسمك." },
                        { score: 3, text: "درجة سمية معتدلة إلى عالية. قد يستفيد جسمك بشكل كبير من استراتيجيات دعم إزالة السموم وتقليل التعرض للمواد الكيميائية." },
                        { score: 6, text: "درجة سمية عالية. من المهم اتخاذ خطوات جادة لتقليل تعرضك للسموم ودعم مسارات التخلص منها في الكبد والأمعاء والجلد." }
                    ]
                },
                'luscher-color-test': {
                    title: 'اختبار لوشير المبسط للألوان',
                    isColorTest: true,
                    colors: [
                        { name: 'أزرق', hex: '#004084' }, { name: 'أخضر', hex: '#006400' }, { name: 'أحمر', hex: '#b00000' }, { name: 'أصفر', hex: '#ffd700' },
                        { name: 'بنفسجي', hex: '#6a0dad' }, { name: 'بني', hex: '#8b4513' }, { name: 'أسود', hex: '#000000' }, { name: 'رمادي', hex: '#808080' }
                    ],
                    interpretations: {
                        'أزرق': 'يشير إلى الحاجة إلى الهدوء والسكينة والرضا. اختيارك له أولاً يعكس رغبة في بيئة مستقرة ومتناغمة.',
                        'أخضر': 'يمثل الثبات والعزيمة والمثابرة. اختياره يعبر عن رغبة في تأكيد الذات والسيطرة على مسار الحياة.',
                        'أحمر': 'يرمز إلى الطاقة والحيوية والرغبة في الفعل والإنجاز. اختياره يعكس حالة من الإثارة والقوة الدافعة.',
                        'أصفر': 'يعبر عن الأمل والتفاؤل والرغبة في التحرر والمستقبل المشرق. اختياره يشير إلى البحث عن السعادة والتوسع.',
                        'بنفسجي': 'مزيج من الأحمر والأزرق، يرمز إلى الرغبة في علاقة صوفية أو سحرية. قد يعبر عن عدم النضج أو الحاجة للهروب من الواقع.',
                        'بني': 'يمثل الجذور والحواس الجسدية. قد يشير اختياره إلى الشعور بالإرهاق والحاجة إلى الراحة واستعادة الحيوية الجسدية.',
                        'أسود': 'يرمز إلى النفي والرفض والتخلي. اختياره كأول لون قد يشير إلى التمرد ضد الوضع الحالي أو الشعور بالضغط الشديد.',
                        'رمادي': 'يمثل الحياد وعدم الرغبة في المشاركة. اختياره قد يعبر عن رغبة في عزل النفس عن الصراعات أو التحفيز الزائد.'
                    }
                }
            };

            const hideQuizModal = () => {
                modal.classList.remove('is-open');
                setTimeout(() => modal.classList.add('hidden'), 300);
            };

            document.querySelectorAll('.quiz-start-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const quizId = btn.dataset.quiz;
                    startQuiz(quizId);
                });
            });
            
            function startQuiz(quizId) {
                const quizData = quizzes[quizId];
                if (quizData.isColorTest) {
                    renderColorTest(quizData);
                } else {
                    renderQuestionnaire(quizData);
                }
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.add('is-open'), 10);
            }
            
            function renderQuestionnaire(quizData) {
                let currentQuestion = 0;
                let score = 0;
                function renderQuestion() {
                    if (currentQuestion >= quizData.questions.length) {
                        renderResult();
                        return;
                    }
                    const q = quizData.questions[currentQuestion];
                    modalContent.innerHTML = `
                        <h3 class="text-2xl font-bold mb-2">${quizData.title}</h3>
                        <p class="text-gray-500 mb-6">السؤال ${currentQuestion + 1} من ${quizData.questions.length}</p>
                        <p class="text-xl font-semibold mb-6 text-center">${q.q}</p>
                        <div class="flex justify-center gap-4">
                           <button class="quiz-answer-btn btn btn-primary text-white py-2 px-8 rounded-full" data-answer="yes">نعم</button>
                           <button class="quiz-answer-btn btn btn-secondary py-2 px-8 rounded-full" data-answer="no">لا</button>
                        </div>
                    `;
                    document.querySelectorAll('.quiz-answer-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            if (e.target.dataset.answer === 'yes') score += q.points;
                            else if (q.points < 0) score -= q.points;
                            currentQuestion++;
                            renderQuestion();
                        });
                    });
                }
                function renderResult() {
                    let resultText = '';
                    for (let i = quizData.results.length - 1; i >= 0; i--) {
                        if (score >= quizData.results[i].score) {
                            resultText = quizData.results[i].text;
                            break;
                        }
                    }
                     modalContent.innerHTML = `<h3 class="text-2xl font-bold mb-2">النتيجة</h3><div class="bg-gray-100 p-6 rounded-lg text-center"><p class="text-lg mb-2">درجتك هي: <span class="font-bold text-2xl text-[--primary-color]">${score}</span></p><p class="text-gray-700">${resultText}</p></div><div class="text-center mt-6"><button class="close-quiz-modal-btn btn btn-primary text-white py-2 px-6 rounded-full">إغلاق</button></div>`;
                    modalContent.querySelector('.close-quiz-modal-btn').addEventListener('click', hideQuizModal);
                }
                renderQuestion();
            }

            function renderColorTest(quizData) {
                let selectedOrder = [];
                const totalColors = quizData.colors.length;

                function updateInstructions() {
                     const instructionEl = modalContent.querySelector('#luscher-instruction');
                     if(instructionEl) {
                        const remaining = totalColors - selectedOrder.length;
                        if (remaining > 0) {
                           instructionEl.textContent = `اختر اللون المفضل لديك من بين الألوان المتبقية. (${remaining} متبقي)`;
                        } else {
                           instructionEl.textContent = 'اكتمل الاختيار! انقر أدناه للحصول على تحليلك.';
                        }
                     }
                }

                function handleColorClick(e) {
                    const swatch = e.target;
                    if (swatch.classList.contains('selected')) return;

                    selectedOrder.push(swatch.dataset.colorName);
                    swatch.classList.add('selected');
                    swatch.setAttribute('data-order', selectedOrder.length);
                    
                    updateInstructions();

                    if (selectedOrder.length === totalColors) {
                        const analyzeBtn = modalContent.querySelector('#analyze-luscher-btn');
                        if(analyzeBtn) {
                           analyzeBtn.classList.remove('hidden');
                           analyzeBtn.classList.add('flex', 'mx-auto');
                        }
                    }
                }

                modalContent.innerHTML = `
                    <h3 class="text-2xl font-bold mb-2">${quizData.title}</h3>
                    <p id="luscher-instructions" class="text-gray-600 mb-4 text-center">اختر اللون المفضل لديك من بين الألوان المتبقية. (8 متبقي)</p>
                    <div class="color-swatch-container">
                        ${quizData.colors.map(c => `<div class="color-swatch" data-color-name="${c.name}" style="background-color: ${c.hex};"></div>`).join('')}
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <p><strong>إخلاء مسؤولية:</strong> هذا الاختبار هو نسخة مبسطة لأغراض الاستكشاف الذاتي فقط ولا يمثل تشخيصاً نفسياً أو طبياً كاملاً.</p>
                    </div>
                    <div class="text-center mt-6">
                        <button id="analyze-luscher-btn" class="hidden btn btn-primary text-white py-2 px-8 rounded-full">احصل على التحليل</button>
                    </div>
                `;

                const swatches = modalContent.querySelectorAll('.color-swatch');
                swatches.forEach(swatch => swatch.addEventListener('click', handleColorClick));

                modalContent.querySelector('#analyze-luscher-btn').addEventListener('click', () => {
                    const firstChoice = selectedOrder[0];
                    const lastChoice = selectedOrder[7];
                    const analysis = `
                        <h3 class="text-2xl font-bold mb-2">تحليل اختياراتك</h3>
                        <div class="text-right space-y-3">
                           <p><strong>تفضيلك الأول (<span class="font-bold text-green-600">هدف مرغوب</span>): ${firstChoice}</strong></p>
                           <p class="text-gray-700 pr-4">${quizData.interpretations[firstChoice]}</p>
                           <p><strong>تفضيلك الأخير (<span class="font-bold text-red-600">صفة مرفوضة</span>): ${lastChoice}</strong></p>
                           <p class="text-gray-700 pr-4">رفضك للون ${lastChoice} قد يشير إلى أنك ترفض بوعي أو بغير وعي الصفات التي يمثلها. ${quizData.interpretations[lastChoice]}</p>
                        </div>
                        <div class="text-center mt-6">
                           <button class="close-quiz-modal-btn btn btn-primary text-white py-2 px-6 rounded-full">إغلاق</button>
                        </div>
                    `;
                    modalContent.innerHTML = analysis;
                    modalContent.querySelector('.close-quiz-modal-btn').addEventListener('click', hideQuizModal);
                });
            }
        }

        // --- JOURNAL MODULE ---
        function initJournal() {
            const form = document.getElementById('journal-form');
            if(!form) return;

            document.getElementById('entry-date').valueAsDate = new Date();

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!currentUser) {
                    showNotification("يجب تسجيل الدخول لحفظ الإدخالات.", "error");
                    return;
                }
                const entry = {
                    date: document.getElementById('entry-date').value,
                    mood: document.getElementById('mood-rating').value,
                    energy: document.getElementById('energy-rating').value,
                    sleep: document.getElementById('sleep-quality').value,
                    symptoms: document.getElementById('symptoms-today').value,
                    createdAt: new Date()
                };

                try {
                    const journalCollection = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'journalEntries');
                    await addDoc(journalCollection, entry);
                    showNotification("تم حفظ الإدخال بنجاح!", "success");
                    form.reset();
                    document.getElementById('entry-date').valueAsDate = new Date();
                    loadJournalEntries(); 
                } catch (error) {
                    console.error("Error saving journal entry: ", error);
                    showNotification("حدث خطأ أثناء حفظ الإدخال.", "error");
                }
            });
        }
        
        function toggleJournalView(isLoggedIn) {
            document.getElementById('journal-content-container').classList.toggle('hidden', !isLoggedIn);
            document.getElementById('journal-login-prompt').classList.toggle('hidden', isLoggedIn);
        }

        async function loadJournalEntries() {
            if (!currentUser) return;
            const entriesContainer = document.getElementById('journal-entries-container');
            entriesContainer.innerHTML = '<p>جاري تحميل السجلات...</p>';

            const journalCollection = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'journalEntries');
            const q = query(journalCollection, limit(30));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                entriesContainer.innerHTML = '<p>لا توجد إدخالات بعد. ابدأ بتسجيل يومك!</p>';
                if(journalChart) journalChart.destroy();
                return;
            }
            
            const entries = [];
            querySnapshot.forEach(doc => {
                entries.push(doc.data());
            });
            
            entries.sort((a, b) => new Date(b.date) - new Date(a.date));

            let entriesHTML = '';
            entries.forEach(data => {
                entriesHTML += `
                    <div class="bg-white p-4 rounded-lg shadow-sm journal-entry">
                        <p class="font-bold text-lg">${data.date}</p>
                        <p class="text-sm"><strong>المزاج:</strong> ${data.mood}/10 | <strong>الطاقة:</strong> ${data.energy}/10 | <strong>النوم:</strong> ${data.sleep || 'N/A'} س</p>
                        ${data.symptoms ? `<p class="text-sm text-gray-600 mt-1"><strong>الأعراض:</strong> ${data.symptoms}</p>` : ''}
                    </div>`;
            });
            entriesContainer.innerHTML = entriesHTML;
            
            renderJournalChart(entries.reverse());
        }

        function renderJournalChart(entries) {
            const ctx = document.getElementById('journal-chart').getContext('2d');
            if (journalChart) {
                journalChart.destroy();
            }
            journalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: entries.map(e => e.date),
                    datasets: [
                        {
                            label: 'مستوى المزاج',
                            data: entries.map(e => e.mood),
                            borderColor: 'rgb(200, 160, 125)',
                            backgroundColor: 'rgba(200, 160, 125, 0.5)',
                            tension: 0.1
                        },
                        {
                            label: 'مستوى الطاقة',
                            data: entries.map(e => e.energy),
                            borderColor: 'rgb(90, 110, 90)',
                            backgroundColor: 'rgba(90, 110, 90, 0.5)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                                responsive: true,
                                 plugins: { legend: { position: 'top' } },
                    scales: { y: { beginAtZero: true, max: 10 } }
                }
            });
        }
    </script>

<script>
 document.addEventListener('DOMContentLoaded', () => {
   const newProduct = {
     id: 'uxira',
     name: "UXIRA – مزيل عرق طبيعي",
     shortDesc: "تركيبة طبيعية من الزيوت وهيدروجين بيروكسيد لتنقية المسام ومنع الروائح بفعالية ونعومة.",
     price: "2900 ريال يمني",
     imageUrl: "assets/images/UXIRA%20%20DEODERANT%20.png",
     whatsappLink: "https://wa.me/967771447111?text=مرحبًا،%20أرغب%20بطلب%20مزيل%20العرق%20UXIRA",
     detailsButtonText: "وصف المنتج",
     fullDesc: `
     <h3 class="text-lg font-bold mb-2">💚 UXIRA – مزيل عرق طبيعي آمن وفعّال</h3>
     <p class="mb-2"><strong>تركيبة متكاملة تجمع بين نقاء الزيوت الطبيعية وقوة الهيدروجين بيروكسيد بتركيز مدروس، لتمنحك حماية يومية من العرق والروائح الكريهة، مع عناية فائقة ببشرة الإبط.</strong></p>
     <h4 class="font-bold mb-1">✅ الفوائد الرئيسية:</h4>
     <ul class="list-disc pr-5 text-right mb-2">
       <li><strong>مزيل عرق طبيعي 100%</strong> بدون أي مواد كيميائية قاسية أو ألمنيوم.</li>
       <li><strong>تنقية عميقة للمسام</strong> من البكتيريا والسموم المسببة للرائحة.</li>
       <li><strong>تفتيح آمن للبشرة الداكنة تحت الإبطين</strong> بفضل خصائص الهيدروجين بيروكسيد المقشرة اللطيفة.</li>
       <li><strong>ترطيب وتهدئة فورية</strong> بفضل مزيج الزيوت النباتية المغذية.</li>
       <li><strong>يحارب البكتيريا دون التأثير على التوازن الطبيعي للجلد.</strong></li>
       <li><strong>آمن للاستخدام اليومي حتى على البشرة الحساسة.</strong></li>
     </ul>
     <p class="font-bold mb-1">🌿 مناسب لمن؟</p>
     <ul class="list-disc pr-5 text-right mb-2">
       <li>من يبحث عن بديل طبيعي وصحي لمزيلات العرق التجارية.</li>
       <li>من يعاني من <strong>اسمرار تحت الإبط</strong> أو <strong>تهيج الجلد</strong> بسبب مزيلات العرق الكيميائية.</li>
       <li>من يريد منتجًا فعالًا يدوم طوال اليوم دون انسداد المسام أو تعطيل التعرّق الطبيعي.</li>
     </ul>
     <p class="font-bold mb-1">🧴 طريقة الاستخدام:</p>
     <ol class="list-decimal pr-5 text-right mb-2">
       <li>يُغسل الإبط ويُجفف بلطف تام.</li>
       <li>يُرَش كمية خفيفة من هيدروجين بيروكسيد ويُترك لـ30–60 ثانية حتى يجف جزئيًا.</li>
       <li>يُوضع طبقة رقيقة من كريم UXIRA ويُترك ليجف طبيعيًا.</li>
       <li>يُستخدم صباحًا ويمكن إعادة الاستخدام حسب الحاجة.</li>
     </ol>
     <p class="font-bold mb-1">🔒 آمن ومُجرّب</p>
     <ul class="list-disc pr-5 text-right">
       <li>✔ خالٍ من الألمنيوم</li>
       <li>✔ خالٍ من العطور الصناعية</li>
       <li>✔ خالٍ من البارابين</li>
       <li>✔ مُختبر على البشرة الحساسة</li>
     </ul>
     `
   };

   // خريطة أوصاف المنتجات الكاملة
   const productDescriptions = { 
     uxira: newProduct.fullDesc,
     tibrahOra: `
       <h4 class="font-bold text-lg">🦷 طِبرة للعناية الفموية المتقدمة | نظام علاجي–منعش يومي</h4>
       <p><strong>منتجان تكميليان يعملان بتناغم:</strong> تنقية عميقة… وانتعاش يدوم. لصحة لثتك، ونقاء فمك، وثقتك كل يوم.</p>
       <h4 class="font-bold">① مضمضة طِبرة العلاجية | Ṭibrah Oral Detox Rinse</h4>
       <ul class="list-disc pr-6 space-y-1">
         <li>تنظيف الفم من السموم والفضلات الحمضية</li>
         <li>تقليل التهابات اللثة ونزيفها</li>
         <li>تفكيك البلاك ومنع التصبغات السطحية</li>
         <li>موازنة بيئة الفم بعد مضغ الأعشاب أو تناول القهوة</li>
       </ul>
       <h4 class="font-bold">② بخاخ طِبرة المنعش | Ṭibrah Herbal Oral Mist</h4>
       <ul class="list-disc pr-6 space-y-1">
         <li>ينعش النفس برائحة عشبية نظيفة</li>
         <li>يهدئ اللثة ويرطّب الفم</li>
         <li>يقلل من أثر التصبغات السريعة بعد الأكل</li>
       </ul>
       <h4 class="font-bold">🛡️ لماذا نثق به؟</h4>
       <ul class="list-disc pr-6 space-y-1">
         <li>تركيبة مُعايرة طبيًا، بدون نكهات صناعية</li>
         <li>مناسب للأسنان الحساسة والتهابات اللثة المزمنة</li>
         <li>يُكمّل عاداتك اليومية بدل أن يعيقها</li>
       </ul>
       <p class="font-semibold">🎯 نتائج متوقعة خلال أسبوعين من الاستخدام المنتظم:</p>
       <ul class="list-disc pr-6 space-y-1">
         <li>إزالة فورية لرائحة الفم الكريهة من الجذور، وليس تغطيتها فقط.</li>
         <li>تقليل ملحوظ لنزيف اللثة والتهابها، خاصة عند التفريش أو المضغ.</li>
         <li>إحساس بنظافة فموية ناعمة وطعم قلوي معتدل غير مزعج.</li>
       </ul>
       <p class="font-semibold">✅ نتائج مؤكدة عند الاستمرار المنتظم:</p>
       <ul class="list-disc pr-6 space-y-1">
         <li>تفكيك وإزالة البؤر التسوسية السطحية او العميقة مبكرا قبل ان تتسبب في تدمر السن</li>
         <li>تحفيز فسيولوجي طبيعي لإعادة اللثة المنسحبة إلى موضعها فوق السن — حتى في حالات ارتخاء اللثة بسبب القات أو الالتهابات المتكررة.</li>
         <li>تقوية ألياف اللثة الداعمة وتقليل ارتخاءها، حتى لدى المدخنين ومتعاطي الأعشاب المخرشة.</li>
         <li>تقليل اصفرار الأسنان الناتج عن الترسبات الحمضية والبقع السطحية.</li>
       </ul>
       <p class="italic">🌿 طِبرة — لأن فمك ليس فقط مدخل الطعام… بل بوابة صحتك الداخلية.</p>
     `
   };

   const container = document.getElementById('store-products-grid');
   if (container) {
     const card = document.createElement('div');
     card.className = "border bg-white border-gray-200 rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 fade-in-up hover:-translate-y-2";
     card.innerHTML = `
       <img src="${newProduct.imageUrl}" alt="${newProduct.name}" class="w-full h-56 object-cover">
       <div class="p-6">
         <h3 class="text-xl font-bold mb-2">${newProduct.name}</h3>
         <p class="text-gray-600 mb-4">${newProduct.shortDesc}</p>
         <p class="text-2xl font-bold text-[--primary-color] mb-4">${newProduct.price}</p>
         <a href="${newProduct.whatsappLink}" target="_blank" class="btn btn-secondary w-full block py-2 rounded-full mb-2">اطلب عبر واتساب</a>
         <button class="btn btn-outline w-full details-button" data-prod="${newProduct.id}">${newProduct.detailsButtonText}</button>
       </div>`;
     container.appendChild(card);
   }

   // Create product modal once
   const modal = document.createElement('div');
   modal.id = 'product-modal';
   modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden';
   modal.innerHTML = `
     <div class="bg-white p-8 rounded-xl max-w-md w-11/12 text-center relative">
       <button id="close-product-modal" class="absolute top-2 right-4 text-2xl text-gray-500">&times;</button>
       <h3 id="modal-product-title" class="text-2xl font-bold mb-4"></h3>
       <div id="modal-product-description" class="text-gray-700 text-right space-y-2 max-h-[70vh] overflow-y-auto"></div>
     </div>`;
   document.body.appendChild(modal);

   const closeModal = () => modal.classList.add('hidden');
   document.getElementById('close-product-modal').addEventListener('click', closeModal);
   modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

   document.addEventListener('click', (e) => {
     const btn = e.target.closest('.details-button');
     if (!btn) return;
     const card = btn.closest('.border');
     const title = card.querySelector('h3')?.textContent || '';
     const id = btn.dataset.prod || '';
     const desc = productDescriptions[id] || '';
     document.getElementById('modal-product-title').textContent = title;
     document.getElementById('modal-product-description').innerHTML = desc;
     modal.classList.remove('hidden');
   });
 });
</script>
</body>
</html>

                    
